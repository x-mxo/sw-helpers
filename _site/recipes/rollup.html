<!DOCTYPE html>
<html>

  








<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Recipes &gt; Rollup Bundling</title>
  <meta name="description" content="(Currently Work in Progress) Service Worker helper libraries. ">

  <!-- The docs server over HTTPS, but site.github.url points to HTTP resouce causing mixed content -->
  <link rel="canonical" href="/recipes/rollup.html">
  <link rel="alternate" type="application/rss+xml" title="sw-helpers" href="/feed.xml">

  <link rel="shortcut icon" href="/themes/images/favicon.ico">

  <!-- Stylesheet -->
  <link href="https://fonts.googleapis.com/css?family=Cutive+Mono|Open+Sans:300,300i,400,600,700" rel="stylesheet">
  <link href="/themes/styles/main.css" rel="stylesheet" type="text/css">

  
</head>


  <body>

    

















<section class="navigation-container">

  <!-- Hamburger Menu -->
  <button class="svg-btn navigation-open-btn js-menu-btn">
    <svg height="30" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
        <path d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
    </svg>
  </button>

  <nav class="navigation-links js-nav-drawer">
      <!-- Logo Header at Top of Nav Drawer -->
      <section class="nav-drawer-header">
        <img class="nav-drawer-header__logo" src="/themes/images/workbox-logo-grey-small.min.svg" alt="Small Workbox Logo" />

        <button class="svg-btn navigation-close-btn js-menu-close-btn">
          <svg height="30" viewBox="0 0 24 24" width="30" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            <path d="M0 0h24v24H0z" fill="none"/>
          </svg>
        </button>
      </section>

      <!-- Actual Links -->
      <ul>
        
          
<li><a href="/">Getting Started</a></li>


        
          
<li><a href="/sw-cli">sw-cli</a></li>


        
          
<li><a href="/sw-build">sw-build</a></li>


        
          
<li><a href="/sw-lib">sw-lib</a></li>


        
          
<li class="drop-down-container js-drop-down-wrapper">
  <span class="navigation-drop-down-btn js-drop-down-btn">Recipes</span>
  <ul class="drop-down-list js-drop-down-list">
  
    
<li><a href="/recipes/webpack">Web Pack</a></li>


  
    
<li><a href="/recipes/gulp">Gulp</a></li>


  
    
<li><a href="/recipes/rollup">Rollup</a></li>


  
    
<li><a href="/recipes/grunt">Grunt</a></li>


  
  </ul>
</li>



        
          
<li><a href="/examples">Examples</a></li>


        
          
<li class="drop-down-container js-drop-down-wrapper">
  <span class="navigation-drop-down-btn js-drop-down-btn">Reference</span>
  <ul class="drop-down-list js-drop-down-list">
  
    
<li><a href="/reference-docs/stable/latest/module-sw-background-sync-queue.html">sw-background-sync-queue</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-broadcast-cache-update.html">sw-broadcast-cache-update</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-build.html">sw-build</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-cache-expiration.html">sw-cache-expiration</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-cacheable-response.html">sw-cacheable-response</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-lib.html">sw-lib</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-offline-google-analytics.html">sw-offline-google-analytics</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-precaching.html">sw-precaching</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-routing.html">sw-routing</a></li>


  
    
<li><a href="/reference-docs/stable/latest/module-sw-runtime-caching.html">sw-runtime-caching</a></li>


  
  </ul>
</li>



        
      </ul>
    </nav>

    <div class="nav-backdrop js-nav-backdrop"></div>

</section>


<header class="page-header">
  <div class="page-header__inner-section">
    <h1>Recipes > Rollup Bundling</h1>
  </div>
</header>


<main>
  <h1 id="rollup-bundling">Rollup Bundling</h1>

<p>These recipes cover the following <code class="highlighter-rouge">sw-lib</code> use case:</p>
<ul>
  <li>You want to write and maintain your own <code class="highlighter-rouge">sw.js</code> file that uses precaching via
<code class="highlighter-rouge">sw-lib.precache()</code> alongside other service worker logic.</li>
  <li>You’d like to use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">ES2015 import syntax</a>
to include <code class="highlighter-rouge">sw-lib</code> and other modules into your service worker.</li>
  <li>You are comfortable using <a href="https://github.com/rollup/rollup"><code class="highlighter-rouge">Rollup</code></a> to
handle transforming the <code class="highlighter-rouge">sw.js</code> file you maintain into a production-ready,
self contained service worker file, containing the <code class="highlighter-rouge">sw-lib</code> library code along
with your custom logic.</li>
  <li>You are comfortable using either <a href="http://gulpjs.com/"><code class="highlighter-rouge">gulp</code></a> or
<a href="https://docs.npmjs.com/misc/scripts"><code class="highlighter-rouge">npm scripts</code></a> as a task runner for your
build process.</li>
</ul>

<h2 id="dependencies">Dependencies</h2>

<ul>
  <li>Working installations of <code class="highlighter-rouge">node</code> (4.0+) &amp; <code class="highlighter-rouge">npm</code>.</li>
  <li><code class="highlighter-rouge">npm install --save-dev sw-build sw-lib rollup rollup-plugin-node-resolve</code></li>
</ul>

<h2 id="service-worker-code">Service Worker Code</h2>

<p>This approach assumes that you have a <code class="highlighter-rouge">src/sw.js</code> that uses <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">ES2015 module
import</a>
syntax, and is structured like:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// Contents of src/sw.js:</span>

<span class="c1">// manifest.js will be created by sw-build; see the next section for details.</span>
<span class="kr">import</span> <span class="nx">manifest</span> <span class="nx">from</span> <span class="s1">'/tmp/manifest.js'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">swLib</span> <span class="nx">from</span> <span class="s1">'sw-lib'</span><span class="p">;</span>
<span class="c1">// imports for any other libraries, e.g. idb-keyval, Firebase Messaging, etc.</span>

<span class="c1">// This will precache the files in your manifest, and keep them up to date.</span>
<span class="nx">swLib</span><span class="p">.</span><span class="nx">precache</span><span class="p">(</span><span class="nx">manifest</span><span class="p">);</span>

<span class="c1">// Any additional runtime service worker logic can go here.</span>
</code></pre>
</div>

<h2 id="your-build-process">Your Build Process</h2>

<p>There are many different ways of running build tasks, and they can’t be listed
exhaustively. Here are recipes that cover two possible approaches, producing the
same ready-to-use service worker as output. You can choose between them based on
whether you’d prefer using <code class="highlighter-rouge">npm scripts</code> or <code class="highlighter-rouge">gulp</code> as your task runner.</p>

<p><strong>Note:</strong> Regardless of which task runner you’re using, make sure that the
generation of the service worker file happens <em>last</em> in the chain of your build
tasks. This ensures that the service worker looks at the final contents of your
<code class="highlighter-rouge">build/</code> directory when determining which files to precache and keep up to date.</p>

<h3 id="npm-scripts">npm scripts</h3>

<p>The following is a basic <code class="highlighter-rouge">node</code> script that can be run as part of a larger build
process, e.g. in <code class="highlighter-rouge">package.json</code> at the end of an
<a href="https://docs.npmjs.com/misc/scripts"><code class="highlighter-rouge">npm scripts</code></a> <code class="highlighter-rouge">"build"</code> chain, like:
<code class="highlighter-rouge">"scripts": {"build": "node build.js &amp;&amp; node build-sw.js"}</code></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// Contents of build-sw.js:</span>

<span class="kr">const</span> <span class="nx">resolve</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'rollup-plugin-node-resolve'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">rollup</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'rollup'</span><span class="p">).</span><span class="nx">rollup</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">swBuild</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'sw-build'</span><span class="p">);</span>

<span class="c1">// Adjust with appropriate paths to your source and output directories.</span>
<span class="kr">const</span> <span class="nx">SRC_DIR</span> <span class="o">=</span> <span class="s1">'src'</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">BUILD_DIR</span> <span class="o">=</span> <span class="s1">'build'</span><span class="p">;</span>

<span class="c1">// The promise chain can be summarized as:</span>
<span class="c1">//   manifest generation -&gt; rollup configuration -&gt; write bundle to disk</span>
<span class="nx">swBuild</span><span class="p">.</span><span class="nx">generateFileManifest</span><span class="p">({</span>
 <span class="c1">// The swDest: option should match the path for manifest.js you provide in your</span>
 <span class="c1">// unbundled service worker file.</span>
 <span class="na">swDest</span><span class="p">:</span> <span class="s1">'/tmp/manifest.js'</span><span class="p">,</span>
 <span class="c1">// Configure patterns to match the files your want the SW to manage.</span>
 <span class="c1">// See https://github.com/isaacs/node-glob##glob-primer</span>
 <span class="na">staticFileGlobs</span><span class="p">:</span> <span class="p">[</span>
   <span class="err">`</span><span class="p">.</span><span class="o">/</span><span class="nx">$</span><span class="p">{</span><span class="nx">BUILD_DIR</span><span class="p">}</span><span class="sr">/{css,images,js}/</span><span class="o">**</span><span class="sr">/*`</span><span class="err">,
</span>   <span class="err">`</span><span class="p">.</span><span class="o">/</span><span class="nx">$</span><span class="p">{</span><span class="nx">BUILD_DIR</span><span class="p">}</span><span class="sr">/index.html`</span><span class="err">,
</span> <span class="p">],</span>
 <span class="na">globDirectory</span><span class="p">:</span> <span class="nx">BUILD_DIR</span><span class="p">,</span>
 <span class="na">format</span><span class="p">:</span> <span class="s1">'es'</span><span class="p">,</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">rollup</span><span class="p">({</span>
 <span class="c1">// This should point to your unbundled service worker code.</span>
 <span class="na">entry</span><span class="p">:</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">SRC_DIR</span><span class="p">}</span><span class="sr">/sw.js`</span><span class="err">,
</span> <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span><span class="nx">resolve</span><span class="p">({</span>
   <span class="na">jsnext</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
   <span class="na">main</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
   <span class="na">browser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
 <span class="p">})],</span>
<span class="p">})).</span><span class="nx">then</span><span class="p">((</span><span class="nx">bundle</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">bundle</span><span class="p">.</span><span class="nx">write</span><span class="p">({</span>
 <span class="na">format</span><span class="p">:</span> <span class="s1">'iife'</span><span class="p">,</span>
 <span class="na">swDest</span><span class="p">:</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">BUILD_DIR</span><span class="p">}</span><span class="sr">/sw.js`</span><span class="err">,
</span><span class="p">}));</span>
</code></pre>
</div>

<h3 id="gulp-tasks">gulp Tasks</h3>

<p>The same basic approach can be run via two <code class="highlighter-rouge">gulp</code> tasks, if you prefer using
<code class="highlighter-rouge">gulp</code> to run build tasks:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'gulp'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">resolve</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'rollup-plugin-node-resolve'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">rollup</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'rollup'</span><span class="p">).</span><span class="nx">rollup</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">swBuild</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'sw-build'</span><span class="p">);</span>

<span class="c1">// Adjust with appropriate paths to your source and output directories.</span>
<span class="kr">const</span> <span class="nx">SRC_DIR</span> <span class="o">=</span> <span class="s1">'src'</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">BUILD_DIR</span> <span class="o">=</span> <span class="s1">'build'</span><span class="p">;</span>

<span class="c1">// This task should be invoked as a dependency of bundle-sw.</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'write-manifest'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">swBuild</span><span class="p">.</span><span class="nx">generateFileManifest</span><span class="p">({</span>
    <span class="c1">// The swDest: option should match the path for manifest.js you provide in your</span>
    <span class="c1">// unbundled service worker file.</span>
    <span class="na">swDest</span><span class="p">:</span> <span class="err">`</span><span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">manifest</span><span class="p">.</span><span class="nx">js</span><span class="err">`</span><span class="p">,</span>
    <span class="c1">// Configure patterns to match the files your want the SW to manage.</span>
    <span class="c1">// See https://github.com/isaacs/node-glob##glob-primer</span>
    <span class="na">staticFileGlobs</span><span class="p">:</span> <span class="p">[</span>
      <span class="err">`</span><span class="p">.</span><span class="o">/</span><span class="nx">$</span><span class="p">{</span><span class="nx">BUILD_DIR</span><span class="p">}</span><span class="sr">/{css,images,js}/</span><span class="o">**</span><span class="sr">/*`</span><span class="err">,
</span>      <span class="err">`</span><span class="p">.</span><span class="o">/</span><span class="nx">$</span><span class="p">{</span><span class="nx">BUILD_DIR</span><span class="p">}</span><span class="sr">/index.html`</span><span class="err">,
</span>    <span class="p">],</span>
    <span class="na">globDirectory</span><span class="p">:</span> <span class="nx">BUILD_DIR</span><span class="p">,</span>
    <span class="na">format</span><span class="p">:</span> <span class="s1">'es'</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// ['write-manifest'] defines that task as a dependency, so running the</span>
<span class="c1">// bundle-sw task will always invoke write-manifest first.</span>
<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'bundle-sw'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'write-manifest'</span><span class="p">],</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">rollup</span><span class="p">({</span>
    <span class="c1">// This should point to your unbundled service worker code.</span>
    <span class="na">entry</span><span class="p">:</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">SRC_DIR</span><span class="p">}</span><span class="sr">/sw.js`</span><span class="err">,
</span>    <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span><span class="nx">resolve</span><span class="p">({</span>
      <span class="na">jsnext</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">main</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">browser</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">})],</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">bundle</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">bundle</span><span class="p">.</span><span class="nx">write</span><span class="p">({</span>
    <span class="na">swDest</span><span class="p">:</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">BUILD_DIR</span><span class="p">}</span><span class="sr">/sw.js`</span><span class="err">,
</span>    <span class="na">format</span><span class="p">:</span> <span class="s1">'iife'</span><span class="p">,</span>
  <span class="p">}));</span>
<span class="p">});</span>
</code></pre>
</div>

</main>

<footer>
  <a href="https://GoogleChrome.github.io/workbox" class="footer__btn footer__workbox-btn" role="button" title="Workbox">
    <img src="/themes/images/workbox-logo-white.min.svg" alt="Workbox Logo" />
  </a>
  <div class="footer__right-logos">
    <div class="footer__logo-row">
      <a href="https://twitter.com/ChromiumDev" class="footer__btn footer__twitter-btn" role="button" title="Twitter">
        <img src="/themes/images/twitter-logo.min.svg" alt="Twitter Logo" />
      </a>
      <a href="https://github.com/GoogleChrome/sw-helpers" class="footer__btn footer__github-btn" role="button" title="GitHub">
        <img src="/themes/images/github-logo.min.svg" alt="Github Logo" />
      </a>
    </div>
    <div class="footer__logo-row">
      <a class="google-dev-logo footer__btn" href="https://developers.google.com/web/">
        <img src="/themes/images/google-dev-logo.min.svg" alt="Google Developers Logo" />
      </a>
    </div>
  </div>
</footer>



  </body>

  








<script src="/themes/scripts/detabinator.js" rel="stylesheet" async defer></script>
<script src="/themes/scripts/nav-drawer.js" rel="stylesheet" async defer></script>
<script src="/themes/scripts/jsdocs-collapse.js" rel="stylesheet" async defer></script>
<script src="/themes/scripts/navigation-controller.js" rel="stylesheet" async defer></script>
<script src="/themes/third_party/anchor-js/anchor.min.js" rel="stylesheet" id="anchorjsscript" async defer></script>


</html>
