{"version":3,"sources":["index.js"],"names":["maxAge","defaultDBName","broadcastMessageAddedType","broadcastMessageFailedType","defaultQueueName","tagNamePrefix","broadcastMeta","allQueuesPlaceholder","replayAllQueuesTag","commonjsGlobal","window","global","self","createCommonjsModule","exports","fn","module","stackframe","factory","_isNumber","isNaN","parseFloat","n","isFinite","_capitalize","str","toUpperCase","substring","_getter","p","StackFrame","obj","Object","booleanProps","concat","numericProps","stringProps","arrayProps","i","props","length","hasOwnProperty","prototype","getArgs","args","setArgs","toString","call","v","TypeError","getEvalOrigin","evalOrigin","setEvalOrigin","getFunctionName","join","getFileName","getLineNumber","getColumnNumber","functionName","fileName","lineNumber","columnNumber","j","k","errorStackParser","ErrorStackParser","parse","ErrorStackParser$$parse","error","stacktrace","parseOpera","stack","match","CHROME_IE_STACK_REGEXP","parseV8OrIE","parseFFOrSafari","Error","extractLocation","ErrorStackParser$$extractLocation","indexOf","urlLike","regExp","exec","replace","parts","ErrorStackParser$$parseV8OrIE","split","filter","line","filtered","map","slice","tokens","pop","locationParts","source","ErrorStackParser$$parseFFOrSafari","SAFARI_NATIVE_CODE_REGEXP","ErrorStackParser$$parseOpera","e","message","parseOpera9","parseOpera11","parseOpera10","ErrorStackParser$$parseOpera9","lines","len","lineRE","result","push","ErrorStackParser$$parseOpera10","ErrorStackParser$$parseOpera11","FIREFOX_SAFARI_STACK_REGEXP","shift","functionCall","argsRaw","atLeastOne","keys","object","parameters","some","parameter","throwError","hasMethod","expectedMethod","isInstance","expectedClass","name","isOneOf","values","includes","isType","actualType","expectedType","isArrayOfType","Array","isArray","item","isArrayOfClass","isSWEnv","ServiceWorkerGlobalScope","isValue","actualValue","expectedValue","stackFrames","assert","_dbName","setDbName","dbName","getDbName","idb","toArray","arr","promisifyRequest","Promise","request","onsuccess","resolve","onerror","reject","promisifyRequestCall","method","apply","then","promisifyCursorRequestCall","value","Cursor","proxyProperties","properties","forEach","defineProperty","ProxyClass","prop","get","targetProp","set","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","Index","_index","index","_cursor","cursor","_request","ObjectStore","_store","store","Transaction","_tx","idbTransaction","complete","oncomplete","onabort","UpgradeDB","_db","db","oldVersion","transaction","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","objectStore","IDBTransaction","createObjectStore","IDBDatabase","funcName","nativeObject","callback","getAll","instance","iterateCursor","query","items","count","continue","open","indexedDB","version","onupgradeneeded","upgradeCallback","event","delete","IDBHelper","constructor","storeName","_name","_version","_storeName","_getDb","_dbPromise","upgradeDB","close","put","tx","key","getAllValues","getAllKeys","asyncToGenerator","step","gen","arg","info","done","err","putResponse","hash","idbObject","response","idbQDb","headers","JSON","stringify","status","body","blob","_ref","getResponse","id","_idbQHelper","_ref2","getQueueableRequest","config","metadata","creationTimestamp","Date","now","url","mode","redirect","credentials","text","requestObject","requestBody","getFetchableRequest","idbRequestObject","Headers","reqObject","Request","cleanupQueue","queueObj","all","queueName","requestQueues","requestData","deletionPromises","itemsToKeep","_ref5","_ref4","_ref3","RequestManager","callbacks","queue","_globalCallbacks","_queue","attachSyncHandler","addEventListener","tag","waitUntil","replayRequests","reduce","promise","_this","getRequestFromQueue","reqData","fetch","ok","clone","onResponse","catch","onRetryFailure","broadcastMessage","broadcastChannel","type","BroadcastChannel","postMessage","meta","payload","_requestCounter","_queueCounter","RequestQueue","_isQueueNameAddedToAllQueue","_queueName","_config","_idbQDb","_broadcastChannel","initQueue","idbQueue","addQueueNameToAllQueues","_this2","allQueues","saveQueue","_this3","_this4","queuableRequest","registration","sync","register","_this5","assign","BackgroundSyncQueue","maxRetentionTime","_requestManager","pushIntoQueue","fetchDidFail","initialize"],"mappings":"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","file":"background-sync-queue.min.mjs","sourcesContent":["const maxAge = 5 * 24 * 60 * 60 * 1000; // 5days\nconst defaultDBName = 'bgQueueSyncDB';\nconst broadcastMessageAddedType = 'BACKGROUND_REQUESTED_ADDED';\nconst broadcastMessageFailedType = 'BACKGROUND_REQUESTED_FAILED';\nconst defaultQueueName = 'DEFAULT_QUEUE';\nconst tagNamePrefix = 'SW_BACKGROUND_QUEUE_TAG_';\nconst broadcastMeta = 'SW_BACKGROUND_SYNC_QUEUE';\nconst allQueuesPlaceholder = 'QUEUES';\nconst replayAllQueuesTag = 'SW_BACKGROUND_QUEUE_TAG_REPLAY';\n\nvar commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\n\n\n\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar stackframe = createCommonjsModule(function (module, exports) {\n(function (root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof undefined === 'function' && undefined.amd) {\n        undefined('stackframe', [], factory);\n    } else {\n        module.exports = factory();\n    }\n}(commonjsGlobal, function () {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function _capitalize(str) {\n        return str[0].toUpperCase() + str.substring(1);\n    }\n\n    function _getter(p) {\n        return function () {\n            return this[p];\n        };\n    }\n\n    var booleanProps = ['isConstructor', 'isEval', 'isNative', 'isToplevel'];\n    var numericProps = ['columnNumber', 'lineNumber'];\n    var stringProps = ['fileName', 'functionName', 'source'];\n    var arrayProps = ['args'];\n\n    function StackFrame(obj) {\n        if (obj instanceof Object) {\n            var props = booleanProps.concat(numericProps.concat(stringProps.concat(arrayProps)));\n            for (var i = 0; i < props.length; i++) {\n                if (obj.hasOwnProperty(props[i]) && obj[props[i]] !== undefined) {\n                    this['set' + _capitalize(props[i])](obj[props[i]]);\n                }\n            }\n        }\n    }\n\n    StackFrame.prototype = {\n        getArgs: function () {\n            return this.args;\n        },\n        setArgs: function (v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        getEvalOrigin: function () {\n            return this.evalOrigin;\n        },\n        setEvalOrigin: function (v) {\n            if (v instanceof StackFrame) {\n                this.evalOrigin = v;\n            } else if (v instanceof Object) {\n                this.evalOrigin = new StackFrame(v);\n            } else {\n                throw new TypeError('Eval Origin must be an Object or StackFrame');\n            }\n        },\n\n        toString: function () {\n            var functionName = this.getFunctionName() || '{anonymous}';\n            var args = '(' + (this.getArgs() || []).join(',') + ')';\n            var fileName = this.getFileName() ? ('@' + this.getFileName()) : '';\n            var lineNumber = _isNumber(this.getLineNumber()) ? (':' + this.getLineNumber()) : '';\n            var columnNumber = _isNumber(this.getColumnNumber()) ? (':' + this.getColumnNumber()) : '';\n            return functionName + args + fileName + lineNumber + columnNumber;\n        }\n    };\n\n    for (var i = 0; i < booleanProps.length; i++) {\n        StackFrame.prototype['get' + _capitalize(booleanProps[i])] = _getter(booleanProps[i]);\n        StackFrame.prototype['set' + _capitalize(booleanProps[i])] = (function (p) {\n            return function (v) {\n                this[p] = Boolean(v);\n            };\n        })(booleanProps[i]);\n    }\n\n    for (var j = 0; j < numericProps.length; j++) {\n        StackFrame.prototype['get' + _capitalize(numericProps[j])] = _getter(numericProps[j]);\n        StackFrame.prototype['set' + _capitalize(numericProps[j])] = (function (p) {\n            return function (v) {\n                if (!_isNumber(v)) {\n                    throw new TypeError(p + ' must be a Number');\n                }\n                this[p] = Number(v);\n            };\n        })(numericProps[j]);\n    }\n\n    for (var k = 0; k < stringProps.length; k++) {\n        StackFrame.prototype['get' + _capitalize(stringProps[k])] = _getter(stringProps[k]);\n        StackFrame.prototype['set' + _capitalize(stringProps[k])] = (function (p) {\n            return function (v) {\n                this[p] = String(v);\n            };\n        })(stringProps[k]);\n    }\n\n    return StackFrame;\n}));\n});\n\nvar errorStackParser = createCommonjsModule(function (module, exports) {\n(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof undefined === 'function' && undefined.amd) {\n        undefined('error-stack-parser', ['stackframe'], factory);\n    } else {\n        module.exports = factory(stackframe);\n    }\n}(commonjsGlobal, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+\\:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+\\:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code\\])?$/;\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?:\\:(\\d+))?(?:\\:(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[\\(\\)]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^\\()]*)|(\\)\\,.*$)/g, '');\n                }\n                var tokens = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').split(/\\s+/).slice(1);\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionName = tokens.join(' ') || undefined;\n                var fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame({\n                    functionName: functionName,\n                    fileName: fileName,\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval\\:\\d+\\:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame({\n                        functionName: line\n                    });\n                } else {\n                    var tokens = line.split('@');\n                    var locationParts = this.extractLocation(tokens.pop());\n                    var functionName = tokens.join('@') || undefined;\n\n                    return new StackFrame({\n                        functionName: functionName,\n                        fileName: locationParts[0],\n                        lineNumber: locationParts[1],\n                        columnNumber: locationParts[2],\n                        source: line\n                    });\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame({\n                        fileName: match[2],\n                        lineNumber: match[1],\n                        source: lines[i]\n                    }));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame({\n                            functionName: match[3] || undefined,\n                            fileName: match[2],\n                            lineNumber: match[1],\n                            source: lines[i]\n                        })\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return filtered.map(function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                        .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                        .replace(/\\([^\\)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^\\)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^\\(]+\\(([^\\)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n\n                return new StackFrame({\n                    functionName: functionName,\n                    args: args,\n                    fileName: locationParts[0],\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        }\n    };\n}));\n});\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/* eslint-disable require-jsdoc */\n\nfunction atLeastOne(object) {\n  const parameters = Object.keys(object);\n  if (!parameters.some(parameter => object[parameter] !== undefined)) {\n    throwError('Please set at least one of the following parameters: ' + parameters.map(p => `'${p}'`).join(', '));\n  }\n}\n\nfunction hasMethod(object, expectedMethod) {\n  const parameter = Object.keys(object).pop();\n  const type = typeof object[parameter][expectedMethod];\n  if (type !== 'function') {\n    throwError(`The '${parameter}' parameter must be an object that exposes a\n      '${expectedMethod}' method.`);\n  }\n}\n\nfunction isInstance(object, expectedClass) {\n  const parameter = Object.keys(object).pop();\n  if (!(object[parameter] instanceof expectedClass)) {\n    throwError(`The '${parameter}' parameter must be an instance of\n      '${expectedClass.name}'`);\n  }\n}\n\nfunction isOneOf(object, values) {\n  const parameter = Object.keys(object).pop();\n  if (!values.includes(object[parameter])) {\n    throwError(`The '${parameter}' parameter must be set to one of the\n      following: ${values}`);\n  }\n}\n\nfunction isType(object, expectedType) {\n  const parameter = Object.keys(object).pop();\n  const actualType = typeof object[parameter];\n  if (actualType !== expectedType) {\n    throwError(`The '${parameter}' parameter has the wrong type. (Expected:\n      ${expectedType}, actual: ${actualType})`);\n  }\n}\n\nfunction isArrayOfType(object, expectedType) {\n  const parameter = Object.keys(object).pop();\n  const message = `The '${parameter}' parameter should be an array containing\n    one or more '${expectedType}' elements.`;\n\n  if (!Array.isArray(object[parameter])) {\n    throwError(message);\n  }\n\n  for (let item of object[parameter]) {\n    if (typeof item !== expectedType) {\n      throwError(message);\n    }\n  }\n}\n\nfunction isArrayOfClass(object, expectedClass) {\n  const parameter = Object.keys(object).pop();\n  const message = `The '${parameter}' parameter should be an array containing\n    one or more '${expectedClass.name}' instances.`;\n\n  if (!Array.isArray(object[parameter])) {\n    throwError(message);\n  }\n\n  for (let item of object[parameter]) {\n    if (!(item instanceof expectedClass)) {\n      throwError(message);\n    }\n  }\n}\n\nfunction isSWEnv() {\n  return 'ServiceWorkerGlobalScope' in self && self instanceof ServiceWorkerGlobalScope;\n}\n\nfunction isValue(object, expectedValue) {\n  const parameter = Object.keys(object).pop();\n  const actualValue = object[parameter];\n  if (actualValue !== expectedValue) {\n    throwError(`The '${parameter}' parameter has the wrong value. (Expected: \n      ${expectedValue}, actual: ${actualValue})`);\n  }\n}\n\nfunction throwError(message) {\n  const error = new Error(message);\n  const stackFrames = errorStackParser.parse(error);\n\n  // If, for some reason, we don't have all the stack information we need,\n  // we'll just end up throwing a basic Error.\n  if (stackFrames.length >= 3) {\n    // Assuming we have the stack frames, set the message to include info\n    // about what the underlying method was, and set the name to reflect\n    // the assertion type that failed.\n    error.message = `Invalid call to ${stackFrames[2].functionName}() — ` + message.replace(/\\s+/g, ' ');\n    error.name = stackFrames[1].functionName.replace(/^Object\\./, '');\n  }\n\n  throw error;\n}\n\nvar assert = {\n  atLeastOne,\n  hasMethod,\n  isInstance,\n  isOneOf,\n  isType,\n  isSWEnv,\n  isValue,\n  isArrayOfType,\n  isArrayOfClass\n};\n\nlet _dbName = defaultDBName;\n\n/**\n * sets the dbName, which is used to store the queue and requests\n * defaults to bgQueueSyncDB\n * @param {String} dbName\n * @private\n */\nfunction setDbName(dbName) {\n  assert.isType({ dbName }, 'string');\n  _dbName = dbName;\n}\n\n/**\n * return the already set indexed db name\n * @return {String}\n * @private\n */\nfunction getDbName() {\n  return _dbName;\n}\n\nvar idb = createCommonjsModule(function (module) {\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  {\n    module.exports = exp;\n  }\n}());\n});\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\n/* eslint-disable require-jsdoc */\n\n/**\n * A wrapper to store for an IDB connection to a particular ObjectStore.\n *\n * @private\n */\nclass IDBHelper {\n  constructor(name, version, storeName) {\n    if (name == undefined || version == undefined || storeName == undefined) {\n      throw Error('name, version, storeName must be passed to the ' + 'constructor.');\n    }\n\n    this._name = name;\n    this._version = version;\n    this._storeName = storeName;\n  }\n\n  /**\n   * Returns a promise that resolves with an open connection to IndexedDB,\n   * either existing or newly opened.\n   *\n   * @private\n   * @return {Promise<DB>}\n   */\n  _getDb() {\n    if (this._dbPromise) {\n      return this._dbPromise;\n    }\n\n    this._dbPromise = idb.open(this._name, this._version, upgradeDB => {\n      upgradeDB.createObjectStore(this._storeName);\n    }).then(db => {\n      return db;\n    });\n\n    return this._dbPromise;\n  }\n\n  close() {\n    if (!this._dbPromise) {\n      return;\n    }\n\n    return this._dbPromise.then(db => {\n      db.close();\n      this._dbPromise = null;\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies saving the key/value\n   * pair to the object store.\n   * Returns a Promise that fulfills when the transaction completes.\n   *\n   * @private\n   * @param {String} key\n   * @param {Object} value\n   * @return {Promise<T>}\n   */\n  put(key, value) {\n    return this._getDb().then(db => {\n      const tx = db.transaction(this._storeName, 'readwrite');\n      const objectStore = tx.objectStore(this._storeName);\n      objectStore.put(value, key);\n      return tx.complete;\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies deleting an entry\n   * from the object store.\n   * Returns a Promise that fulfills when the transaction completes.\n   *\n   * @private\n   * @param {String} key\n   * @return {Promise<T>}\n   */\n  delete(key) {\n    return this._getDb().then(db => {\n      const tx = db.transaction(this._storeName, 'readwrite');\n      const objectStore = tx.objectStore(this._storeName);\n      objectStore.delete(key);\n      return tx.complete;\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies getting a key's value\n   * from the object store.\n   * Returns a promise that fulfills with the value.\n   *\n   * @private\n   * @param {String} key\n   * @return {Promise<Object>}\n   */\n  get(key) {\n    return this._getDb().then(db => {\n      return db.transaction(this._storeName).objectStore(this._storeName).get(key);\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies getting all the values\n   * in an object store.\n   * Returns a promise that fulfills with all the values.\n   *\n   * @private\n   * @return {Promise<Array<Object>>}\n   */\n  getAllValues() {\n    return this._getDb().then(db => {\n      return db.transaction(this._storeName).objectStore(this._storeName).getAll();\n    });\n  }\n\n  /**\n   * Wrapper on top of the idb wrapper, which simplifies getting all the keys\n   * in an object store.\n   * Returns a promise that fulfills with all the keys.\n   *\n   * @private\n   * @param {String} storeName\n   * @return {Promise<Array<Object>>}\n   */\n  getAllKeys() {\n    return this._getDb().then(db => {\n      return db.transaction(this._storeName).objectStore(this._storeName).getAllKeys();\n    });\n  }\n}\n\nvar asyncToGenerator = function (fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);\n    return new Promise(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);\n          var value = info.value;\n        } catch (error) {\n          reject(error);\n          return;\n        }\n\n        if (info.done) {\n          resolve(value);\n        } else {\n          return Promise.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n};\n\n/**\n * Puts the fetched response in the IDB\n *\n * @param {Object} config\n * @private\n */\nlet putResponse = (() => {\n\tvar _ref = asyncToGenerator(function* ({ hash, idbObject, response, idbQDb }) {\n\t\tconst _idbQHelper = idbQDb;\n\t\tidbObject.response = {\n\t\t\theaders: JSON.stringify([...response.headers]),\n\t\t\tstatus: response.status,\n\t\t\tbody: yield response.blob()\n\t\t};\n\t\t_idbQHelper.put(hash, idbObject);\n\t});\n\n\treturn function putResponse(_x) {\n\t\treturn _ref.apply(this, arguments);\n\t};\n})();\n\n/**\n * This function returns the fetched response for the given id of the request\n *\n * @memberof module:sw-background-sync-queue\n *\n * @param {String} id The ID of the request given back by the broaadcast\n * channel\n * @return {Object} response Fetched response of the request.\n */\n\n\nlet getResponse = (() => {\n\tvar _ref2 = asyncToGenerator(function* ({ id }) {\n\t\tconst _idbQHelper = new IDBHelper(getDbName(), 1, 'QueueStore');\n\t\tconst object = yield _idbQHelper.get(id);\n\t\tif (object && object.response) {\n\t\t\treturn object.response;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t});\n\n\treturn function getResponse(_x2) {\n\t\treturn _ref2.apply(this, arguments);\n\t};\n})();\n\n/**\n * takes a request and gives back JSON object that is storable in IDB\n *\n * @param {Request} request request object to transform\n * into iDB storable object\n * @param {Object} config config object to be\n * stored along in the iDB\n * @return {Object} indexable object for iDB\n *\n * @memberOf RequestManager\n * @private\n */\nlet getQueueableRequest = (() => {\n\tvar _ref = asyncToGenerator(function* ({ request, config }) {\n\t\tlet requestObject = {\n\t\t\tconfig,\n\t\t\tmetadata: {\n\t\t\t\tcreationTimestamp: Date.now()\n\t\t\t}\n\t\t};\n\t\trequestObject.request = {\n\t\t\turl: request.url,\n\t\t\theaders: JSON.stringify([...request.headers]),\n\t\t\tmode: request.mode,\n\t\t\tmethod: request.method,\n\t\t\tredirect: request.redirect,\n\t\t\tcredentials: request.credentials\n\t\t};\n\t\tconst requestBody = yield request.text();\n\t\tif (requestBody.length > 0) {\n\t\t\trequestObject.request.body = requestBody;\n\t\t}\n\t\treturn requestObject;\n\t});\n\n\treturn function getQueueableRequest(_x) {\n\t\treturn _ref.apply(this, arguments);\n\t};\n})();\n\n/**\n * takes an object and return a Request object to be executed by\n * the browser\n * @param {Object} idbRequestObject\n * @return {Request}\n * @private\n */\n\n\nlet getFetchableRequest = (() => {\n\tvar _ref2 = asyncToGenerator(function* ({ idbRequestObject }) {\n\t\tlet reqObject = {\n\t\t\tmode: idbRequestObject.mode,\n\t\t\tmethod: idbRequestObject.method,\n\t\t\tredirect: idbRequestObject.redirect,\n\t\t\theaders: new Headers(JSON.parse(idbRequestObject.headers)),\n\t\t\tcredentials: idbRequestObject.credentials\n\t\t};\n\t\tif (idbRequestObject.body) {\n\t\t\treqObject.body = idbRequestObject.body;\n\t\t}\n\t\treturn new Request(idbRequestObject.url, reqObject);\n\t});\n\n\treturn function getFetchableRequest(_x2) {\n\t\treturn _ref2.apply(this, arguments);\n\t};\n})();\n\n/**\n * clean up the queue, deleting all the tasks who are either damaged or\n * whose maxAge has expired\n *\n * @memberOf Queue\n * @private\n * @return {Promise}\n */\n\n\nlet cleanupQueue = (() => {\n\tvar _ref3 = asyncToGenerator(function* () {\n\t\tlet db = new IDBHelper(getDbName(), 1, 'QueueStore');\n\t\tlet queueObj = yield db.get(allQueuesPlaceholder);\n\n\t\tif (!queueObj) {\n\t\t\treturn null;\n\t\t}\n\n\t\tyield Promise.all(queueObj.map((() => {\n\t\t\tvar _ref4 = asyncToGenerator(function* (queueName) {\n\t\t\t\tconst requestQueues = yield db.get(queueName);\n\t\t\t\tlet itemsToKeep = [];\n\t\t\t\tlet deletionPromises = [];\n\t\t\t\tyield Promise.all(requestQueues.map((() => {\n\t\t\t\t\tvar _ref5 = asyncToGenerator(function* (hash) {\n\t\t\t\t\t\tconst requestData = yield db.get(hash);\n\t\t\t\t\t\tif (requestData && requestData.metadata && requestData.metadata.creationTimestamp + requestData.config.maxAge <= Date.now()) {\n\t\t\t\t\t\t\t// Delete items that are too old.\n\t\t\t\t\t\t\tdeletionPromises.push(db.delete(hash));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Keep elements whose definition exists in idb.\n\t\t\t\t\t\t\titemsToKeep.push(hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn function (_x4) {\n\t\t\t\t\t\treturn _ref5.apply(this, arguments);\n\t\t\t\t\t};\n\t\t\t\t})()));\n\t\t\t\tyield Promise.all(deletionPromises);\n\t\t\t\tdb.put(queueName, itemsToKeep);\n\t\t\t});\n\n\t\t\treturn function (_x3) {\n\t\t\t\treturn _ref4.apply(this, arguments);\n\t\t\t};\n\t\t})()));\n\t});\n\n\treturn function cleanupQueue() {\n\t\treturn _ref3.apply(this, arguments);\n\t};\n})();\n\n/**\n * Class to handle all the request related\n * transformations, replaying, event handling\n * broadcasting back to controlled pages etc.\n * @class\n * @private\n */\nclass RequestManager {\n\t/**\n  * Initializes the request manager\n  * stores the callbacks object, maintains config and\n  * attaches event handler\n  * @param {Object=} config\n  *\n  * @memberOf RequestManager\n  * @private\n  */\n\tconstructor({ callbacks, queue }) {\n\t\tthis._globalCallbacks = callbacks || {};\n\t\tthis._queue = queue;\n\t\tthis.attachSyncHandler();\n\t}\n\n\t/**\n  * attaches sync handler to replay requests when\n  * sync event is fired\n  *\n  * @memberOf RequestManager\n  * @private\n  */\n\tattachSyncHandler() {\n\t\tself.addEventListener('sync', event => {\n\t\t\tif (event.tag === tagNamePrefix + this._queue.queueName || event.tag === replayAllQueuesTag) {\n\t\t\t\tevent.waitUntil(this.replayRequests());\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n  * function to start playing requests\n  * in sequence\n  * @return {void}\n  *\n  * @memberOf RequestManager\n  * @private\n  */\n\treplayRequests() {\n\t\tvar _this = this;\n\n\t\treturn this._queue.queue.reduce((promise, hash) => {\n\t\t\treturn promise.then((() => {\n\t\t\t\tvar _ref = asyncToGenerator(function* (item) {\n\t\t\t\t\tconst reqData = yield _this._queue.getRequestFromQueue({ hash });\n\t\t\t\t\tif (reqData.response) {\n\t\t\t\t\t\t// check if request is not played already\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst request = yield getFetchableRequest({\n\t\t\t\t\t\tidbRequestObject: reqData.request\n\t\t\t\t\t});\n\n\t\t\t\t\treturn fetch(request).then(function (response) {\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// not blocking on putResponse.\n\t\t\t\t\t\t\tputResponse({\n\t\t\t\t\t\t\t\thash,\n\t\t\t\t\t\t\t\tidbObject: reqData,\n\t\t\t\t\t\t\t\tresponse: response.clone(),\n\t\t\t\t\t\t\t\tidbQDb: _this._queue.idbQDb\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t_this._globalCallbacks.onResponse && _this._globalCallbacks.onResponse(hash, response);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\t_this._globalCallbacks.onRetryFailure && _this._globalCallbacks.onRetryFailure(hash, err);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn function (_x) {\n\t\t\t\t\treturn _ref.apply(this, arguments);\n\t\t\t\t};\n\t\t\t})());\n\t\t}, Promise.resolve());\n\t}\n}\n\n/**\n * broadcasts the message with the given type and url\n *\n * @param {BroadcastChannel} broadcastChannel which is used to push the\n * updates on\n * @param {Object} input\n * @param {string} input.type Type of the message (either success or failure)\n * @param {string} input.url Url for which the request was queued\n * @private\n */\nfunction broadcastMessage({ broadcastChannel, type, url }) {\n\tif (!broadcastChannel) return;\n\n\tassert.isInstance({ broadcastChannel }, BroadcastChannel);\n\tassert.isType({ type }, 'string');\n\tassert.isType({ url }, 'string');\n\n\tbroadcastChannel.postMessage({\n\t\ttype: type,\n\t\tmeta: broadcastMeta,\n\t\tpayload: {\n\t\t\turl: url\n\t\t}\n\t});\n}\n\nlet _requestCounter = 0;\nlet _queueCounter = 0;\n\n/**\n * Queue class to maintain and perform on the logical requests queue\n *\n * @class RequestQueue\n * @private\n */\nclass RequestQueue {\n\t/**\n  * Creates an instance of RequestQueue.\n  *\n  * @param {Object} config\n  *\n  * @memberOf RequestQueue\n  * @private\n  */\n\tconstructor({\n\t\tconfig,\n\t\tqueueName = defaultQueueName + '_' + _queueCounter++,\n\t\tidbQDb,\n\t\tbroadcastChannel\n\t}) {\n\t\tthis._isQueueNameAddedToAllQueue = false;\n\t\tthis._queueName = queueName;\n\t\tthis._config = config;\n\t\tthis._idbQDb = idbQDb;\n\t\tthis._broadcastChannel = broadcastChannel;\n\t\tthis._queue = [];\n\t\tthis.initQueue();\n\t}\n\n\t/**\n  * initializes the queue from the IDB store\n  *\n  * @memberOf RequestQueue\n  * @private\n  */\n\tinitQueue() {\n\t\tvar _this = this;\n\n\t\treturn asyncToGenerator(function* () {\n\t\t\tconst idbQueue = yield _this._idbQDb.get(_this._queueName);\n\t\t\t_this._queue.concat(idbQueue);\n\t\t})();\n\t}\n\n\t/**\n  * adds the current queueName to all queue array\n  *\n  * @memberOf RequestQueue\n  * @private\n  */\n\taddQueueNameToAllQueues() {\n\t\tvar _this2 = this;\n\n\t\treturn asyncToGenerator(function* () {\n\t\t\tif (!_this2._isQueueNameAddedToAllQueue) {\n\t\t\t\tlet allQueues = yield _this2._idbQDb.get(allQueuesPlaceholder);\n\t\t\t\tallQueues = allQueues || [];\n\t\t\t\tif (!allQueues.includes(_this2._queueName)) {\n\t\t\t\t\tallQueues.push(_this2._queueName);\n\t\t\t\t}\n\t\t\t\t_this2._idbQDb.put(allQueuesPlaceholder, allQueues);\n\t\t\t\t_this2._isQueueNameAddedToAllQueue = true;\n\t\t\t}\n\t\t})();\n\t}\n\n\t/**\n  * saves the logical queue to IDB\n  *\n  * @memberOf RequestQueue\n  * @private\n  */\n\tsaveQueue() {\n\t\tvar _this3 = this;\n\n\t\treturn asyncToGenerator(function* () {\n\t\t\tyield _this3._idbQDb.put(_this3._queueName, _this3._queue);\n\t\t})();\n\t}\n\n\t/**\n  * push any request to background sync queue which would be played later\n  * preferably when network comes back\n  *\n  * @param {Request} request request object to be queued by this\n  *\n  * @memberOf Queue\n  * @private\n  */\n\tpush({ request }) {\n\t\tvar _this4 = this;\n\n\t\treturn asyncToGenerator(function* () {\n\t\t\tassert.isInstance({ request }, Request);\n\n\t\t\tconst hash = `${request.url}!${Date.now()}!${_requestCounter++}`;\n\t\t\tconst queuableRequest = yield getQueueableRequest({\n\t\t\t\trequest,\n\t\t\t\tconfig: _this4._config\n\t\t\t});\n\t\t\ttry {\n\t\t\t\t_this4._queue.push(hash);\n\n\t\t\t\t// add to queue\n\t\t\t\t_this4.saveQueue();\n\t\t\t\t_this4._idbQDb.put(hash, queuableRequest);\n\t\t\t\tyield _this4.addQueueNameToAllQueues();\n\t\t\t\t// register sync\n\t\t\t\tself.registration && self.registration.sync.register(tagNamePrefix + _this4._queueName);\n\n\t\t\t\t// broadcast the success of request added to the queue\n\t\t\t\tbroadcastMessage({\n\t\t\t\t\tbroadcastChannel: _this4._broadcastChannel,\n\t\t\t\t\ttype: broadcastMessageAddedType,\n\t\t\t\t\tid: hash,\n\t\t\t\t\turl: request.url\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\t// broadcast the failure of request added to the queue\n\t\t\t\tbroadcastMessage({\n\t\t\t\t\tbroadcastChannel: _this4._broadcastChannel,\n\t\t\t\t\ttype: broadcastMessageFailedType,\n\t\t\t\t\tid: hash,\n\t\t\t\t\turl: request.url\n\t\t\t\t});\n\t\t\t}\n\t\t})();\n\t}\n\n\t/**\n  * get the Request from the queue at a particular index\n  *\n  * @param {string} hash hash of the request at the given index\n  * @return {Request} request object corresponding to given hash\n  * @memberOf Queue\n  * @private\n  */\n\tgetRequestFromQueue({ hash }) {\n\t\tvar _this5 = this;\n\n\t\treturn asyncToGenerator(function* () {\n\t\t\tassert.isType({ hash }, 'string');\n\n\t\t\tif (_this5._queue.includes(hash)) {\n\t\t\t\treturn yield _this5._idbQDb.get(hash);\n\t\t\t}\n\t\t})();\n\t}\n\n\t/**\n  * returns the instance of queue.\n  *\n  * @readonly\n  *\n  * @memberOf RequestQueue\n  * @private\n  */\n\tget queue() {\n\t\treturn Object.assign([], this._queue);\n\t}\n\n\t/**\n  * returns the name of the current queue\n  *\n  * @readonly\n  *\n  * @memberOf RequestQueue\n  * @private\n  */\n\tget queueName() {\n\t\treturn this._queueName;\n\t}\n\n\t/**\n  * returns the instance of IDBStore\n  *\n  * @readonly\n  *\n  * @memberOf RequestQueue\n  * @private\n  */\n\tget idbQDb() {\n\t\treturn this._idbQDb;\n\t}\n}\n\n/**\n * Use the instance of this class to push the failed requests into the queue.\n *\n * @example\n * // Case 1: When you want to push the requests manually\n * let bgQueue = new goog.backgroundSyncQueue.BackgroundSyncQueue();\n * self.addEventListener('fetch', function(e) {\n *\t\tif (e.request.url.startsWith('https://jsonplaceholder.typicode.com')) {\n *\t\t\tconst clone = e.request.clone();\n *\t\t\te.respondWith(fetch(e.request).catch((err)=>{\n *\t\t\t\tbgQueue.pushIntoQueue({\n *\t\t\t\t\trequest: clone,\n *\t\t\t\t});\n *\t\t\t\tthrow err;\n *\t\t\t}));\n *\t \t}\n * });\n * // Case 2: When you want the higher level framework to take care of failed\n * // requests\n * let bgQueue = new goog.backgroundSyncQueue.BackgroundSyncQueue({callbacks:\n *\t\t{\n *\t\t\tonResponse: async(hash, res) => {\n *\t\t\t\tself.registration.showNotification('Background sync demo', {\n *  \t\t\t\tbody: 'Product has been purchased.',\n *\t \t \t\t\ticon: 'https://shop.polymer-project.org/images/shop-icon-384.png',\n *\t\t\t\t});\n *\t\t\t},\n *\t\t\tonRetryFailure: (hash) => {},\n *\t\t},\n * });\n *\n * const requestWrapper = new goog.runtimeCaching.RequestWrapper({\n * \tplugins: [bgQueue],\n * });\n *\n * const route = new goog.routing.RegExpRoute({\n * \tregExp: new RegExp('^https://jsonplaceholder.typicode.com'),\n * \thandler: new goog.runtimeCaching.NetworkOnly({requestWrapper}),\n * });\n *\n * const router = new goog.routing.Router();\n * router.registerRoute({route});\n *\n * @memberof module:sw-background-sync-queue\n */\nclass BackgroundSyncQueue {\n\t/**\n  * Creates an instance of BackgroundSyncQueue with the given options\n  *\n  * @param {Object} [input]\n  * @param {Number} [input.maxRetentionTime = 5 days] Time for which a queued\n  * request will live in the queue(irespective of failed/success of replay).\n  * @param {Object} [input.callbacks] Callbacks for successfull/ failed\n  * replay of a request.\n  * @param {string} [input.queueName] Queue name inside db in which\n  * requests will be queued.\n  * @param {BroadcastChannel=} [input.broadcastChannel] BroadcastChannel\n  * which will be used to publish messages when the request will be queued.\n  */\n\tconstructor({ maxRetentionTime = maxAge, callbacks, queueName,\n\t\tbroadcastChannel } = {}) {\n\t\tif (queueName) {\n\t\t\tassert.isType({ queueName }, 'string');\n\t\t}\n\n\t\tif (maxRetentionTime) {\n\t\t\tassert.isType({ maxRetentionTime }, 'number');\n\t\t}\n\n\t\tif (broadcastChannel) {\n\t\t\tassert.isInstance({ broadcastChannel }, BroadcastChannel);\n\t\t}\n\n\t\tthis._queue = new RequestQueue({\n\t\t\tconfig: {\n\t\t\t\tmaxAge: maxRetentionTime\n\t\t\t},\n\t\t\tqueueName,\n\t\t\tidbQDb: new IDBHelper(getDbName(), 1, 'QueueStore'),\n\t\t\tbroadcastChannel\n\t\t});\n\t\tthis._requestManager = new RequestManager({ callbacks,\n\t\t\tqueue: this._queue });\n\t}\n\n\t/**\n  * This function pushes a given request into the IndexedDb Queue\n  *\n  * @param {Object} input\n  * @param {Request} input.request The request which is to be queued\n  *\n  * @return {Promise} Promise which resolves when the request is pushed in\n  * the queue.\n  */\n\tpushIntoQueue({ request }) {\n\t\tassert.isInstance({ request }, Request);\n\t\treturn this._queue.push({ request });\n\t}\n\n\t/**\n  * Wraps `pushIntoQueue` in a callback used by higher level framework.\n  * This function pushes a given request into the IndexedDb Queue.\n  * NOTE: If you are writting the fetch handler for background sync manually,\n  * please ignore this.\n  *\n  * @param {Object} input\n  * @param {Request} input.request The request which is to be queued\n  *\n  * @return {Promise} Promise which resolves when the request is pushed in\n  * the queue.\n  */\n\tfetchDidFail({ request }) {\n\t\treturn this.pushIntoQueue({ request });\n\t}\n\n\t/**\n  * Replays all the requests in the queue, this can be used for custom timing\n  * of replaying requests may be in an environment where sync event is not\n  * supported.\n  * @return {Promise} A listener for when the requests have been replayed.\n  */\n\treplayRequests() {\n\t\treturn this._requestManager.replayRequests();\n\t}\n}\n\n/**\n * In order to use this library call `goog.backgroundSyncQueue.initialize()`.\n * It will take care of setting up IndexedDB for storing requests and broadcast\n * channel for communication of request creations. Also this attaches a handler\n * to `sync` event and replays the queued requeusts.\n *\n * @memberof module:sw-background-sync-queue\n *\n * @param {Object} [input] The input object to this function\n * @param {string} [input.dbName] The name of the db to store requests and\n * responses\n */\nlet initialize = (() => {\n  var _ref = asyncToGenerator(function* ({ dbName } = {}) {\n    if (dbName) {\n      assert.isType({ dbName }, 'string');\n      setDbName(dbName);\n    }\n    yield cleanupQueue();\n  });\n\n  return function initialize() {\n    return _ref.apply(this, arguments);\n  };\n})();\n\n/*\n Copyright 2016 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n http://www.apache.org/licenses/LICENSE-2.0\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n */\n\n/**\n * # sw-background-sync-queue\n *\n * Queues failed requests and uses the Background Sync API to replay those\n * requests at a later time when the network state has changed.\n *\n * @module sw-background-sync-queue\n */\n\nexport { initialize, getResponse, BackgroundSyncQueue };\n"]}