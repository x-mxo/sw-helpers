/*
 Copyright 2016 Google Inc. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
(function(t,r){'object'==typeof exports&&'undefined'!=typeof module?module.exports=r():'function'==typeof define&&define.amd?define(r):(t.goog=t.goog||{},t.goog.SWLib=r())})(this,function(){'use strict';function createCommonjsModule(ce,de){return de={exports:{}},ce(de,de.exports),de.exports}function throwError(ce){const de=new Error(ce),ue=u.parse(de);throw 3<=ue.length&&(de.message=`Invalid call to ${ue[2].functionName}() â€” `+ce.replace(/\s+/g,' '),de.name=ue[1].functionName.replace(/^Object\./,'')),de}function normalizeHandler(ce){return'object'==typeof ce?(l.hasMethod({handler:ce},'handle'),ce):(l.isType({handler:ce},'function'),{handle:ce})}function parse(ce,de){for(var me,ue=[],le=0,he=0,pe='',ge=de&&de.delimiter||'/';null!=(me=x.exec(ce));){var fe=me[0],_e=me[1],ye=me.index;if(pe+=ce.slice(he,ye),he=ye+fe.length,_e){pe+=_e[1];continue}var be=ce[he],ve=me[2],Ee=me[3],Ne=me[4],xe=me[5],Ce=me[6],qe=me[7];pe&&(ue.push(pe),pe='');var Te=me[2]||ge,ke=Ne||xe;ue.push({name:Ee||le++,prefix:ve||'',delimiter:Te,optional:'?'===Ce||'*'===Ce,repeat:'+'===Ce||'*'===Ce,partial:null!=ve&&null!=be&&be!==ve,asterisk:!!qe,pattern:ke?escapeGroup(ke):qe?'.*':'[^'+escapeString(Te)+']+?'})}return he<ce.length&&(pe+=ce.substr(he)),pe&&ue.push(pe),ue}function encodeURIComponentPretty(ce){return encodeURI(ce).replace(/[\/?#]/g,function(de){return'%'+de.charCodeAt(0).toString(16).toUpperCase()})}function encodeAsterisk(ce){return encodeURI(ce).replace(/[?#]/g,function(de){return'%'+de.charCodeAt(0).toString(16).toUpperCase()})}function tokensToFunction(ce){for(var de=Array(ce.length),ue=0;ue<ce.length;ue++)'object'==typeof ce[ue]&&(de[ue]=new RegExp('^(?:'+ce[ue].pattern+')$'));return function(le,he){for(var ye,pe='',ge=le||{},me=he||{},fe=me.pretty?encodeURIComponentPretty:encodeURIComponent,_e=0;_e<ce.length;_e++){if(ye=ce[_e],'string'==typeof ye){pe+=ye;continue}var ve,be=ge[ye.name];if(null==be)if(ye.optional){ye.partial&&(pe+=ye.prefix);continue}else throw new TypeError('Expected "'+ye.name+'" to be defined');if(f(be)){if(!ye.repeat)throw new TypeError('Expected "'+ye.name+'" to not repeat, but received `'+JSON.stringify(be)+'`');if(0===be.length)if(ye.optional)continue;else throw new TypeError('Expected "'+ye.name+'" to not be empty');for(var Ee=0;Ee<be.length;Ee++){if(ve=fe(be[Ee]),!de[_e].test(ve))throw new TypeError('Expected all "'+ye.name+'" to match "'+ye.pattern+'", but received `'+JSON.stringify(ve)+'`');pe+=(0===Ee?ye.prefix:ye.delimiter)+ve}continue}if(ve=ye.asterisk?encodeAsterisk(be):fe(be),!de[_e].test(ve))throw new TypeError('Expected "'+ye.name+'" to match "'+ye.pattern+'", but received "'+ve+'"');pe+=ye.prefix+ve}return pe}}function escapeString(ce){return ce.replace(/([.+*?=^!:${}()[\]|\/\\])/g,'\\$1')}function escapeGroup(ce){return ce.replace(/([=!:$\/()])/g,'\\$1')}function attachKeys(ce,de){return ce.keys=de,ce}function flags(ce){return ce.sensitive?'':'i'}function regexpToRegexp(ce,de){var ue=ce.source.match(/\((?!\?)/g);if(ue)for(var le=0;le<ue.length;le++)de.push({name:le,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return attachKeys(ce,de)}function arrayToRegexp(ce,de,ue){for(var le=[],he=0;he<ce.length;he++)le.push(pathToRegexp(ce[he],de,ue).source);var pe=new RegExp('(?:'+le.join('|')+')',flags(ue));return attachKeys(pe,de)}function stringToRegexp(ce,de,ue){return tokensToRegExp(parse(ce,ue),de,ue)}function tokensToRegExp(ce,de,ue){f(de)||(ue=de||ue,de=[]),ue=ue||{};for(var me,le=ue.strict,he=!1!==ue.end,pe='',ge=0;ge<ce.length;ge++)if(me=ce[ge],'string'==typeof me)pe+=escapeString(me);else{var fe=escapeString(me.prefix),_e='(?:'+me.pattern+')';de.push(me),me.repeat&&(_e+='(?:'+fe+_e+')*'),_e=me.optional?me.partial?fe+'('+_e+')?':'(?:'+fe+'('+_e+'))?':fe+'('+_e+')',pe+=_e}var ye=escapeString(ue.delimiter||'/'),be=pe.slice(-ye.length)===ye;return le||(pe=(be?pe.slice(0,-ye.length):pe)+'(?:'+ye+'(?=$))?'),pe+=he?'$':le&&be?'':'(?='+ye+'|$)',attachKeys(new RegExp('^'+pe,flags(ue)),de)}function pathToRegexp(ce,de,ue){return f(de)||(ue=de||ue,de=[]),ue=ue||{},ce instanceof RegExp?regexpToRegexp(ce,de):f(ce)?arrayToRegexp(ce,de,ue):stringToRegexp(ce,de,ue)}function broadcastUpdate({channel:ce,cacheName:de,url:ue,source:le}){l.isInstance({channel:ce},BroadcastChannel),l.isType({cacheName:de},'string'),l.isType({source:le},'string'),l.isType({url:ue},'string'),ce.postMessage({type:z,meta:le,payload:{cacheName:de,updatedUrl:ue}})}function responsesAreSame({first:ce,second:de,headersToCheck:ue}={}){if(!(ce instanceof Response&&de instanceof Response&&ue instanceof Array))throw Y.createError('responses-are-same-parameters-required');const le=ue.some((he)=>{return ce.headers.has(he)&&de.headers.has(he)});return le?ue.every((he)=>{return ce.headers.has(he)===de.headers.has(he)&&ce.headers.get(he)===de.headers.get(he)}):(I.log({message:`Unable to determine whether the response has been updated
        because none of the headers that would be checked are present.`,data:{'First Response':ce,'Second Response':de,'Headers To Check':JSON.stringify(ue)}}),!0)}class ErrorFactory$1{constructor(ce){this._errors=ce}createError(ce,de){if(!(ce in this._errors))throw new Error(`Unable to generate error '${ce}'.`);let ue=this._errors[ce].replace(/\s+/g,' '),le=null;de&&(ue+=` [${de.message}]`,le=de.stack);const he=new Error;return he.name=ce,he.message=ue,he.stack=le,he}}const t={'not-in-sw':'sw-lib must be loaded in your service worker file.','unsupported-route-type':'Routes must be either a express style route string, a Regex to capture request URLs or a Route instance.','empty-express-string':'The Express style route string must have some characters, an empty string is invalid.','bad-revisioned-cache-list':`The 'precache()' method expects`+`an array of revisioned urls like so: ['/example/hello.1234.txt', `+`{path: 'hello.txt', revision: '1234'}]`,'navigation-route-url-string':`The registerNavigationRoute() method `+`expects a URL string as its first parameter.`,'bad-cache-id':`The 'cacheId' parameter must be a string with at least `+`one character`,'bad-clients-claim':`The 'clientsClaim' parameter must be a boolean.`,'bad-directory-index':`The 'directoryIndex' parameter must be a boolean.`};var r=new ErrorFactory$1(t);const a={'express-route-invalid-path':`When using ExpressRoute, you must
    provide a path that starts with a '/' character (to match same-origin
    requests) or that starts with 'http' (to match cross-origin requests)`};var s=new ErrorFactory$1(a),o='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,d=createCommonjsModule(function(ce){(function(ue,le){'use strict';ce.exports=le()})(o,function(){'use strict';function _isNumber(_e){return!isNaN(parseFloat(_e))&&isFinite(_e)}function _capitalize(_e){return _e[0].toUpperCase()+_e.substring(1)}function _getter(_e){return function(){return this[_e]}}function StackFrame(_e){if(_e instanceof Object)for(var ye=ue.concat(le.concat(he.concat(pe))),be=0;be<ye.length;be++)_e.hasOwnProperty(ye[be])&&void 0!==_e[ye[be]]&&this['set'+_capitalize(ye[be])](_e[ye[be]])}var ue=['isConstructor','isEval','isNative','isToplevel'],le=['columnNumber','lineNumber'],he=['fileName','functionName','source'],pe=['args'];StackFrame.prototype={getArgs:function(){return this.args},setArgs:function(_e){if('[object Array]'!==Object.prototype.toString.call(_e))throw new TypeError('Args must be an Array');this.args=_e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(_e){if(_e instanceof StackFrame)this.evalOrigin=_e;else if(_e instanceof Object)this.evalOrigin=new StackFrame(_e);else throw new TypeError('Eval Origin must be an Object or StackFrame')},toString:function(){var _e=this.getFunctionName()||'{anonymous}',ye='('+(this.getArgs()||[]).join(',')+')',be=this.getFileName()?'@'+this.getFileName():'',ve=_isNumber(this.getLineNumber())?':'+this.getLineNumber():'',Ee=_isNumber(this.getColumnNumber())?':'+this.getColumnNumber():'';return _e+ye+be+ve+Ee}};for(var ge=0;ge<ue.length;ge++)StackFrame.prototype['get'+_capitalize(ue[ge])]=_getter(ue[ge]),StackFrame.prototype['set'+_capitalize(ue[ge])]=function(_e){return function(ye){this[_e]=!!ye}}(ue[ge]);for(var me=0;me<le.length;me++)StackFrame.prototype['get'+_capitalize(le[me])]=_getter(le[me]),StackFrame.prototype['set'+_capitalize(le[me])]=function(_e){return function(ye){if(!_isNumber(ye))throw new TypeError(_e+' must be a Number');this[_e]=+ye}}(le[me]);for(var fe=0;fe<he.length;fe++)StackFrame.prototype['get'+_capitalize(he[fe])]=_getter(he[fe]),StackFrame.prototype['set'+_capitalize(he[fe])]=function(_e){return function(ye){this[_e]=ye+''}}(he[fe]);return StackFrame})}),u=createCommonjsModule(function(ce){(function(ue,le){'use strict';ce.exports=le(d)})(o,function ErrorStackParser(ue){'use strict';var le=/(^|@)\S+\:\d+/,he=/^\s*at .*(\S+\:\d+|\(native\))/m,pe=/^(eval@)?(\[native code\])?$/;return{parse:function ErrorStackParser$$parse(ge){if('undefined'!=typeof ge.stacktrace||'undefined'!=typeof ge['opera#sourceloc'])return this.parseOpera(ge);if(ge.stack&&ge.stack.match(he))return this.parseV8OrIE(ge);if(ge.stack)return this.parseFFOrSafari(ge);throw new Error('Cannot parse given Error object')},extractLocation:function ErrorStackParser$$extractLocation(ge){if(-1===ge.indexOf(':'))return[ge];var me=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/,fe=me.exec(ge.replace(/[\(\)]/g,''));return[fe[1],fe[2]||void 0,fe[3]||void 0]},parseV8OrIE:function ErrorStackParser$$parseV8OrIE(ge){var me=ge.stack.split('\n').filter(function(fe){return!!fe.match(he)},this);return me.map(function(fe){-1<fe.indexOf('(eval ')&&(fe=fe.replace(/eval code/g,'eval').replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,''));var _e=fe.replace(/^\s+/,'').replace(/\(eval code/g,'(').split(/\s+/).slice(1),ye=this.extractLocation(_e.pop()),be=_e.join(' ')||void 0,ve=-1<['eval','<anonymous>'].indexOf(ye[0])?void 0:ye[0];return new ue({functionName:be,fileName:ve,lineNumber:ye[1],columnNumber:ye[2],source:fe})},this)},parseFFOrSafari:function ErrorStackParser$$parseFFOrSafari(ge){var me=ge.stack.split('\n').filter(function(fe){return!fe.match(pe)},this);return me.map(function(fe){if(-1<fe.indexOf(' > eval')&&(fe=fe.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,':$1')),-1===fe.indexOf('@')&&-1===fe.indexOf(':'))return new ue({functionName:fe});var _e=fe.split('@'),ye=this.extractLocation(_e.pop()),be=_e.join('@')||void 0;return new ue({functionName:be,fileName:ye[0],lineNumber:ye[1],columnNumber:ye[2],source:fe})},this)},parseOpera:function ErrorStackParser$$parseOpera(ge){return!ge.stacktrace||-1<ge.message.indexOf('\n')&&ge.message.split('\n').length>ge.stacktrace.split('\n').length?this.parseOpera9(ge):ge.stack?this.parseOpera11(ge):this.parseOpera10(ge)},parseOpera9:function ErrorStackParser$$parseOpera9(ge){for(var ve,me=/Line (\d+).*script (?:in )?(\S+)/i,fe=ge.message.split('\n'),_e=[],ye=2,be=fe.length;ye<be;ye+=2)ve=me.exec(fe[ye]),ve&&_e.push(new ue({fileName:ve[2],lineNumber:ve[1],source:fe[ye]}));return _e},parseOpera10:function ErrorStackParser$$parseOpera10(ge){for(var ve,me=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,fe=ge.stacktrace.split('\n'),_e=[],ye=0,be=fe.length;ye<be;ye+=2)ve=me.exec(fe[ye]),ve&&_e.push(new ue({functionName:ve[3]||void 0,fileName:ve[2],lineNumber:ve[1],source:fe[ye]}));return _e},parseOpera11:function ErrorStackParser$$parseOpera11(ge){var me=ge.stack.split('\n').filter(function(fe){return!!fe.match(le)&&!fe.match(/^Error created at/)},this);return me.map(function(fe){var _e=fe.split('@'),ye=this.extractLocation(_e.pop()),be=_e.shift()||'',ve=be.replace(/<anonymous function(: (\w+))?>/,'$2').replace(/\([^\)]*\)/g,'')||void 0,Ee;be.match(/\(([^\)]*)\)/)&&(Ee=be.replace(/^[^\(]+\(([^\)]*)\)$/,'$1'));var Ne=Ee===void 0||'[arguments not available]'===Ee?void 0:Ee.split(',');return new ue({functionName:ve,args:Ne,fileName:ye[0],lineNumber:ye[1],columnNumber:ye[2],source:fe})},this)}}})}),l={atLeastOne:function atLeastOne(ce){const de=Object.keys(ce);de.some((ue)=>ce[ue]!==void 0)||throwError('Please set at least one of the following parameters: '+de.map((ue)=>`'${ue}'`).join(', '))},hasMethod:function hasMethod(ce,de){const ue=Object.keys(ce).pop(),le=typeof ce[ue][de];'function'!=le&&throwError(`The '${ue}' parameter must be an object that exposes a
      '${de}' method.`)},isInstance:function isInstance(ce,de){const ue=Object.keys(ce).pop();ce[ue]instanceof de||throwError(`The '${ue}' parameter must be an instance of
      '${de.name}'`)},isOneOf:function isOneOf(ce,de){const ue=Object.keys(ce).pop();de.includes(ce[ue])||throwError(`The '${ue}' parameter must be set to one of the
      following: ${de}`)},isType:function isType(ce,de){const ue=Object.keys(ce).pop(),le=typeof ce[ue];le!==de&&throwError(`The '${ue}' parameter has the wrong type. (Expected:
      ${de}, actual: ${le})`)},isSWEnv:function isSWEnv(){return'ServiceWorkerGlobalScope'in self&&self instanceof ServiceWorkerGlobalScope},isValue:function isValue(ce,de){const ue=Object.keys(ce).pop(),le=ce[ue];le!==de&&throwError(`The '${ue}' parameter has the wrong value. (Expected: 
      ${de}, actual: ${le})`)},isArrayOfType:function isArrayOfType(ce,de){const ue=Object.keys(ce).pop(),le=`The '${ue}' parameter should be an array containing
    one or more '${de}' elements.`;Array.isArray(ce[ue])||throwError(le);for(let he of ce[ue])typeof he!==de&&throwError(le)},isArrayOfClass:function isArrayOfClass(ce,de){const ue=Object.keys(ce).pop(),le=`The '${ue}' parameter should be an array containing
    one or more '${de.name}' instances.`;Array.isArray(ce[ue])||throwError(le);for(let he of ce[ue])he instanceof de||throwError(le)}};const g=['DELETE','GET','HEAD','POST','PUT'];class Route{constructor({match:ce,handler:de,method:ue}={}){this.handler=normalizeHandler(de),l.isType({match:ce},'function'),this.match=ce,ue?(l.isOneOf({method:ue},g),this.method=ue):this.method='GET'}}var f=Array.isArray||function(ce){return'[object Array]'==Object.prototype.toString.call(ce)},_=pathToRegexp,x=new RegExp(['(\\\\.)','([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))'].join('|'),'g');_.parse=parse,_.compile=function compile(ce,de){return tokensToFunction(parse(ce,de))},_.tokensToFunction=tokensToFunction,_.tokensToRegExp=tokensToRegExp;class ExpressRoute extends Route{constructor({path:ce,handler:de,method:ue}){if(!(ce.startsWith('/')||ce.startsWith('http')))throw s.createError('express-route-invalid-path');let le=[];const he=_(ce,le);super({match:({url:ge})=>{if(ce.startsWith('/')&&ge.origin!==location.origin)return null;const me=ce.startsWith('/')?ge.pathname:ge.href,fe=me.match(he);if(!fe)return null;const _e={};return le.forEach((ye,be)=>{_e[ye.name]=fe[be+1]}),_e},handler:de,method:ue})}}class LogGroup{constructor({title:ce,isPrimary:de}={}){this._isPrimary=de||!1,this._groupTitle=ce||'',this._logs=[],this._childGroups=[],this._isFirefox=!1,/Firefox\/\d*\.\d*/.exec(navigator.userAgent)&&(this._isFirefox=!0),this._isEdge=!1,/Edge\/\d*\.\d*/.exec(navigator.userAgent)&&(this._isEdge=!0)}addLog(ce){this._logs.push(ce)}addChildGroup(ce){0===ce._logs.length||this._childGroups.push(ce)}print(){return this._isEdge?this._printEdgeFriendly():void(this._openGroup(),this._logs.forEach((ce)=>{this._printLogDetails(ce)}),this._childGroups.forEach((ce)=>{ce.print()}),this._closeGroup())}_printEdgeFriendly(){this._logs.forEach((ce)=>{let ue=ce.message;'string'==typeof ue&&(ue=ue.replace(/%c/g,''));const le=[ue];ce.error&&le.push(ce.error),ce.args&&le.push(ce.args);const he=ce.logFunc||console.log;he(...le)}),this._childGroups.forEach((ce)=>{ce.print()})}_printLogDetails(ce){const de=ce.logFunc?ce.logFunc:console.log;let ue=ce.message,le=[ue];ce.colors&&!this._isEdge&&(le=le.concat(ce.colors)),ce.args&&(le=le.concat(ce.args)),de(...le)}_openGroup(){if(this._isPrimary){if(0===this._childGroups.length)return;const ce=this._logs.shift();if(this._isFirefox)return void this._printLogDetails(ce);ce.logFunc=console.group,this._printLogDetails(ce)}else console.groupCollapsed(this._groupTitle)}_closeGroup(){this._isPrimary&&0===this._childGroups.length||console.groupEnd()}}self.goog=self.goog||{},self.goog.LOG_LEVEL=self.goog.LOG_LEVEL||{none:-1,verbose:0,debug:1,warn:2,error:3};const C=`#bdc3c7`,q=`#7f8c8d`,O=`#2ecc71`,L=`#f1c40f`,w=`#e74c3c`,T=`#3498db`;var I=new class LogHelper{constructor(){this._defaultLogLevel='localhost'===location.hostname?self.goog.LOG_LEVEL.debug:self.goog.LOG_LEVEL.none}log(ce){this._printMessage(self.goog.LOG_LEVEL.verbose,ce)}debug(ce){this._printMessage(self.goog.LOG_LEVEL.debug,ce)}warn(ce){this._printMessage(self.goog.LOG_LEVEL.warn,ce)}error(ce){this._printMessage(self.goog.LOG_LEVEL.error,ce)}_printMessage(ce,de){if(this._shouldLogMessage(ce,de)){const ue=this._getAllLogGroups(ce,de);ue.print()}}_getAllLogGroups(ce,de){const ue=new LogGroup({isPrimary:!0,title:'sw-helpers log.'}),le=this._getPrimaryMessageDetails(ce,de);if(ue.addLog(le),de.error){const pe={message:de.error,logFunc:console.error};ue.addLog(pe)}const he=new LogGroup({title:'Extra Information.'});if(de.that&&de.that.constructor&&de.that.constructor.name){const pe=de.that.constructor.name;he.addLog(this._getKeyValueDetails('class',pe))}return de.data&&('object'!=typeof de.data||de.data instanceof Array?he.addLog(this._getKeyValueDetails('additionalData',de.data)):Object.keys(de.data).forEach((pe)=>{he.addLog(this._getKeyValueDetails(pe,de.data[pe]))})),ue.addChildGroup(he),ue}_getKeyValueDetails(ce,de){return{message:`%c${ce}: `,colors:[`color: ${T}`],args:de}}_getPrimaryMessageDetails(ce,de){let ue,le;ce===self.goog.LOG_LEVEL.verbose?(ue='Info',le=C):ce===self.goog.LOG_LEVEL.debug?(ue='Debug',le=O):ce===self.goog.LOG_LEVEL.warn?(ue='Warn',le=L):ce===self.goog.LOG_LEVEL.error?(ue='Error',le=w):void 0;let he=`%cðŸ”§ %c[${ue}]`;const pe=[`color: ${C}`,`color: ${le}`];let ge;return'string'==typeof de?ge=de:de.message&&(ge=de.message),ge&&(ge=ge.replace(/\s+/g,' '),he+=`%c ${ge}`,pe.push(`color: ${q}; font-weight: normal`)),{message:he,colors:pe}}_shouldLogMessage(ce,de){if(!de)return!1;let ue=this._defaultLogLevel;return self&&self.goog&&'number'==typeof self.goog.logLevel&&(ue=self.goog.logLevel),ue===self.goog.LOG_LEVEL.none||ce<ue?!1:!0}};class NavigationRoute extends Route{constructor({whitelist:ce,blacklist:de,handler:ue}={}){l.isArrayOfClass({whitelist:ce},RegExp),de?l.isArrayOfClass({blacklist:de},RegExp):de=[];super({match:({event:he,url:pe})=>{let me,ge=!1;return'navigate'===he.request.mode&&(ce.some((fe)=>fe.test(pe.pathname))?de.some((fe)=>fe.test(pe.pathname))?me=`The navigation route is not being used, since the `+`request URL matches both the whitelist and blacklist.`:(me=`The navigation route is being used.`,ge=!0):me=`The navigation route is not being used, since the `+`URL being navigated to doesn't match the whitelist.`,I.debug({that:this,message:me,data:{'request-url':pe.href,whitelist:ce,blacklist:de,handler:ue}})),ge},handler:ue,method:'GET'})}}class RegExpRoute extends Route{constructor({regExp:ce,handler:de,method:ue}){l.isInstance({regExp:ce},RegExp);super({match:({url:he})=>{const pe=ce.exec(he.href);return pe?he.origin!==location.origin&&0!==pe.index?(I.debug({that:this,message:`Skipping route, because the RegExp match didn't occur `+`at the start of the URL.`,data:{url:he.href,regExp:ce}}),null):pe.slice(1):null},handler:de,method:ue})}}class Router$2{constructor({handleFetch:ce}={}){'undefined'==typeof ce&&(ce=!0),this._routes=new Map,ce&&this._addFetchListener()}_addFetchListener(){self.addEventListener('fetch',(ce)=>{const de=new URL(ce.request.url);if(!de.protocol.startsWith('http'))return void I.log({that:this,message:'URL does not start with HTTP and so not passing through the router.',data:{request:ce.request}});let ue,le;for(let he of this._routes.get(ce.request.method)||[]){const pe=he.match({url:de,event:ce});if(pe){le=he,I.log({that:this,message:'The router found a matching route.',data:{route:le,request:ce.request}});let ge=pe;Array.isArray(ge)&&0===ge.length?ge=void 0:ge.constructor===Object&&0===Object.keys(ge).length&&(ge=void 0),ue=he.handler.handle({url:de,event:ce,params:ge});break}}!ue&&this.defaultHandler&&(ue=this.defaultHandler.handle({url:de,event:ce})),ue&&this.catchHandler&&(ue=ue.catch((he)=>{return this.catchHandler.handle({url:de,event:ce,error:he})})),ue&&ce.respondWith(ue.then((he)=>{return I.debug({that:this,message:'The router is managing a route with a response.',data:{route:le,request:ce.request,response:he}}),he}))})}setDefaultHandler({handler:ce}={}){this.defaultHandler=normalizeHandler(ce)}setCatchHandler({handler:ce}={}){this.catchHandler=normalizeHandler(ce)}registerRoutes({routes:ce}={}){l.isArrayOfClass({routes:ce},Route);for(let de of ce)this._routes.has(de.method)||this._routes.set(de.method,[]),this._routes.get(de.method).unshift(de)}registerRoute({route:ce}={}){l.isInstance({route:ce},Route),this.registerRoutes({routes:[ce]})}}class Router$$1 extends Router$2{constructor(ce,de){super({handleFetch:de}),this._revisionedCacheName=ce}registerRoute(ce,de){if('function'==typeof de&&(de={handle:de}),'string'==typeof ce){if(0===ce.length)throw r.createError('empty-express-string');super.registerRoute({route:new ExpressRoute({path:ce,handler:de})})}else if(ce instanceof RegExp)super.registerRoute({route:new RegExpRoute({regExp:ce,handler:de})});else if(ce instanceof Route)super.registerRoute({route:ce});else throw r.createError('unsupported-route-type')}registerNavigationRoute(ce,de={}){if('string'!=typeof ce)throw r.createError('navigation-route-url-string');const ue='cacheName'in de?de.cacheName:this._revisionedCacheName;super.registerRoute({route:new NavigationRoute({handler:()=>caches.match(ce,{cacheName:ue}),whitelist:de.whitelist||[/./],blacklist:de.blacklist||[]})})}}const P={'multiple-cache-will-update-plugins':'You cannot register more than one plugin that implements cacheWillUpdate.','multiple-cache-will-match-plugins':'You cannot register more than one plugin that implements cacheWillMatch.','invalid-response-for-caching':'The fetched response could not be cached due to an invalid response code.','no-response-received':'No response received; falling back to cache.','bad-cache-id':`The 'cacheId' parameter must be a string with at least `+`one character.`};var D=new ErrorFactory$1(P);class CacheableResponse{constructor({statuses:ce,headers:de}={}){l.atLeastOne({statuses:ce,headers:de}),ce!==void 0&&l.isArrayOfType({statuses:ce},'number'),de!==void 0&&l.isType({headers:de},'object'),this.statuses=ce,this.headers=de}isResponseCacheable({request:ce,response:de}={}){l.isInstance({response:de},Response);let ue=!0;if(this.statuses&&(ue=this.statuses.includes(de.status)),this.headers&&ue&&(ue=Object.keys(this.headers).some((le)=>{return de.headers.get(le)===this.headers[le]})),!ue){const le={response:de};this.statuses&&(le['valid-status-codes']=JSON.stringify(this.statuses)),this.headers&&(le['valid-headers']=JSON.stringify(this.headers)),ce&&(le.request=ce),I.debug({message:`The response does not meet the criteria for being added to the
          cache.`,data:le})}return ue}}class CacheableResponsePlugin extends CacheableResponse{cacheWillUpdate({request:ce,response:de}={}){return this.isResponseCacheable({request:ce,response:de})}}const R=({cacheId:ce}={})=>{let de=`sw-runtime-caching`;return ce&&(de=`${ce}-${de}`),self&&self.registration&&(de+=`-${self.registration.scope}`),de},S=['cacheDidUpdate','cacheWillMatch','cacheWillUpdate','fetchDidFail','requestWillFetch'];var A=({response:ce})=>{l.isInstance({response:ce},Response);const de=ce.clone(),ue='body'in de?Promise.resolve(de.body):de.blob();return ue.then((le)=>{return new Response(le,{headers:de.headers,status:de.status,statusText:de.statusText})})},W=function(ce){return function(){var de=ce.apply(this,arguments);return new Promise(function(ue,le){function step(he,pe){try{var ge=de[he](pe),me=ge.value}catch(fe){return void le(fe)}return ge.done?void ue(me):Promise.resolve(me).then(function(fe){step('next',fe)},function(fe){step('throw',fe)})}return step('next')})}};class RequestWrapper{constructor({cacheName:ce,cacheId:de,plugins:ue,fetchOptions:le,matchOptions:he}={}){if(de&&('string'!=typeof de||0===de.length))throw D.createError('bad-cache-id');ce?(l.isType({cacheName:ce},'string'),this.cacheName=ce,de&&(this.cacheName=`${de}-${this.cacheName}`)):this.cacheName=R({cacheId:de}),le&&(l.isType({fetchOptions:le},'object'),this.fetchOptions=le),he&&(l.isType({matchOptions:he},'object'),this.matchOptions=he),this.plugins=new Map,ue&&(l.isArrayOfType({plugins:ue},'object'),ue.forEach((pe)=>{for(let ge of S)if('function'==typeof pe[ge]){if(!this.plugins.has(ge))this.plugins.set(ge,[]);else if('cacheWillUpdate'===ge)throw D.createError('multiple-cache-will-update-plugins');else if('cacheWillMatch'===ge)throw D.createError('multiple-cache-will-match-plugins');this.plugins.get(ge).push(pe)}})),this.plugins.has('cacheWillUpdate')&&(this._userSpecifiedCachableResponsePlugin=this.plugins.get('cacheWillUpdate')[0])}getDefaultCacheableResponsePlugin(){return this._defaultCacheableResponsePlugin||(this._defaultCacheableResponsePlugin=new CacheableResponsePlugin({statuses:[200]})),this._defaultCacheableResponsePlugin}getCache(){var ce=this;return W(function*(){return ce._cache||(ce._cache=yield caches.open(ce.cacheName)),ce._cache})()}match({request:ce}){var de=this;return W(function*(){l.atLeastOne({request:ce});const ue=yield de.getCache();let le=yield ue.match(ce,de.matchOptions);if(de.plugins.has('cacheWillMatch')){const he=de.plugins.get('cacheWillMatch')[0];le=he.cacheWillMatch({request:ce,cache:ue,cachedResponse:le,matchOptions:de.matchOptions})}return le})()}fetch({request:ce}){var de=this;return W(function*(){'string'==typeof ce?ce=new Request(ce):l.isInstance({request:ce},Request);const ue=de.plugins.has('fetchDidFail')?ce.clone():null;if(de.plugins.has('requestWillFetch'))for(let le of de.plugins.get('requestWillFetch')){const he=le.requestWillFetch({request:ce});l.isInstance({returnedPromise:he},Promise);const pe=yield he;l.isInstance({returnedRequest:pe},Request),ce=pe}try{return yield fetch(ce,de.fetchOptions)}catch(le){if(de.plugins.has('fetchDidFail'))for(let he of de.plugins.get('fetchDidFail'))he.fetchDidFail({request:ue.clone()});throw le}})()}fetchAndCache({request:ce,waitOnCache:de,cacheKey:ue,cacheResponsePlugin:le,cleanRedirects:he}){var pe=this;return W(function*(){l.atLeastOne({request:ce});let ge;const me=yield pe.fetch({request:ce}),fe=pe._userSpecifiedCachableResponsePlugin||le||pe.getDefaultCacheableResponsePlugin(),_e=fe.cacheWillUpdate({request:ce,response:me});if(_e){const ye=he&&me.redirected?yield A({response:me}):me.clone();ge=pe.getCache().then((()=>{var be=W(function*(ve){let Ee;const Ne=ue||ce;if('opaque'!==me.type&&pe.plugins.has('cacheDidUpdate')&&(Ee=yield pe.match({request:Ne})),yield ve.put(Ne,ye),pe.plugins.has('cacheDidUpdate'))for(let xe of pe.plugins.get('cacheDidUpdate'))yield xe.cacheDidUpdate({cacheName:pe.cacheName,oldResponse:Ee,newResponse:ye,url:'url'in Ne?Ne.url:Ne})});return function(){return be.apply(this,arguments)}})())}else if(!_e&&de)throw D.createError('invalid-response-for-caching');return de&&ge&&(yield ge),me})()}}class Handler{constructor({requestWrapper:ce,waitOnCache:de}={}){this.requestWrapper=ce?ce:new RequestWrapper,this.waitOnCache=!!de}handle({event:ce,params:de}={}){throw Error('This abstract method must be implemented in a subclass.')}}class CacheFirst extends Handler{handle({event:ce}={}){var de=this;return W(function*(){l.isInstance({event:ce},FetchEvent);const ue=yield de.requestWrapper.match({request:ce.request});return ue||(yield de.requestWrapper.fetchAndCache({request:ce.request,waitOnCache:de.waitOnCache}))})()}}class CacheOnly extends Handler{handle({event:ce}={}){var de=this;return W(function*(){return l.isInstance({event:ce},FetchEvent),yield de.requestWrapper.match({request:ce.request})})()}}class NetworkFirst extends Handler{constructor(ce={}){super(ce),this._cacheablePlugin=new CacheableResponsePlugin({statuses:[0,200]});const{networkTimeoutSeconds:de}=ce;de&&(l.isType({networkTimeoutSeconds:de},'number'),this.networkTimeoutSeconds=de)}handle({event:ce}={}){var de=this;return W(function*(){l.isInstance({event:ce},FetchEvent);const ue=[];let le;de.networkTimeoutSeconds&&ue.push(new Promise(function(pe){le=setTimeout(function(){pe(de.requestWrapper.match({request:ce.request}))},1e3*de.networkTimeoutSeconds)}));const he=de.requestWrapper.fetchAndCache({request:ce.request,waitOnCache:de.waitOnCache,cacheResponsePlugin:de._cacheablePlugin}).then(function(pe){return le&&clearTimeout(le),pe?pe:Promise.reject(D.createError('no-response-received'))}).catch(function(){return de.requestWrapper.match({request:ce.request})});return ue.push(he),Promise.race(ue)})()}}class NetworkOnly extends Handler{handle({event:ce}={}){var de=this;return W(function*(){return l.isInstance({event:ce},FetchEvent),yield de.requestWrapper.fetch({request:ce.request})})()}}class StaleWhileRevalidate extends Handler{constructor(ce={}){super(ce),this._cacheablePlugin=new CacheableResponsePlugin({statuses:[0,200]})}handle({event:ce}={}){var de=this;return W(function*(){l.isInstance({event:ce},FetchEvent);const ue=de.requestWrapper.fetchAndCache({request:ce.request,waitOnCache:de.waitOnCache,cacheResponsePlugin:de._cacheablePlugin}).catch(function(){return Response.error()}),le=yield de.requestWrapper.match({request:ce.request});return le||(yield ue)})()}}let F=`sw-cache-expiration`;self&&self.registration&&(F+=`-${self.registration.scope}`);const M=F,G='url',V='timestamp';var K=createCommonjsModule(function(ce){'use strict';(function(){function toArray(ue){return Array.prototype.slice.call(ue)}function promisifyRequest(ue){return new Promise(function(le,he){ue.onsuccess=function(){le(ue.result)},ue.onerror=function(){he(ue.error)}})}function promisifyRequestCall(ue,le,he){var pe,ge=new Promise(function(me,fe){pe=ue[le].apply(ue,he),promisifyRequest(pe).then(me,fe)});return ge.request=pe,ge}function promisifyCursorRequestCall(ue,le,he){var pe=promisifyRequestCall(ue,le,he);return pe.then(function(ge){return ge?new Cursor(ge,pe.request):void 0})}function proxyProperties(ue,le,he){he.forEach(function(pe){Object.defineProperty(ue.prototype,pe,{get:function(){return this[le][pe]},set:function(ge){this[le][pe]=ge}})})}function proxyRequestMethods(ue,le,he,pe){pe.forEach(function(ge){ge in he.prototype&&(ue.prototype[ge]=function(){return promisifyRequestCall(this[le],ge,arguments)})})}function proxyMethods(ue,le,he,pe){pe.forEach(function(ge){ge in he.prototype&&(ue.prototype[ge]=function(){return this[le][ge].apply(this[le],arguments)})})}function proxyCursorRequestMethods(ue,le,he,pe){pe.forEach(function(ge){ge in he.prototype&&(ue.prototype[ge]=function(){return promisifyCursorRequestCall(this[le],ge,arguments)})})}function Index(ue){this._index=ue}function Cursor(ue,le){this._cursor=ue,this._request=le}function ObjectStore(ue){this._store=ue}function Transaction(ue){this._tx=ue,this.complete=new Promise(function(le,he){ue.oncomplete=function(){le()},ue.onerror=function(){he(ue.error)},ue.onabort=function(){he(ue.error)}})}function UpgradeDB(ue,le,he){this._db=ue,this.oldVersion=le,this.transaction=new Transaction(he)}function DB(ue){this._db=ue}proxyProperties(Index,'_index',['name','keyPath','multiEntry','unique']),proxyRequestMethods(Index,'_index',IDBIndex,['get','getKey','getAll','getAllKeys','count']),proxyCursorRequestMethods(Index,'_index',IDBIndex,['openCursor','openKeyCursor']),proxyProperties(Cursor,'_cursor',['direction','key','primaryKey','value']),proxyRequestMethods(Cursor,'_cursor',IDBCursor,['update','delete']),['advance','continue','continuePrimaryKey'].forEach(function(ue){ue in IDBCursor.prototype&&(Cursor.prototype[ue]=function(){var le=this,he=arguments;return Promise.resolve().then(function(){return le._cursor[ue].apply(le._cursor,he),promisifyRequest(le._request).then(function(pe){return pe?new Cursor(pe,le._request):void 0})})})}),ObjectStore.prototype.createIndex=function(){return new Index(this._store.createIndex.apply(this._store,arguments))},ObjectStore.prototype.index=function(){return new Index(this._store.index.apply(this._store,arguments))},proxyProperties(ObjectStore,'_store',['name','keyPath','indexNames','autoIncrement']),proxyRequestMethods(ObjectStore,'_store',IDBObjectStore,['put','add','delete','clear','get','getAll','getKey','getAllKeys','count']),proxyCursorRequestMethods(ObjectStore,'_store',IDBObjectStore,['openCursor','openKeyCursor']),proxyMethods(ObjectStore,'_store',IDBObjectStore,['deleteIndex']),Transaction.prototype.objectStore=function(){return new ObjectStore(this._tx.objectStore.apply(this._tx,arguments))},proxyProperties(Transaction,'_tx',['objectStoreNames','mode']),proxyMethods(Transaction,'_tx',IDBTransaction,['abort']),UpgradeDB.prototype.createObjectStore=function(){return new ObjectStore(this._db.createObjectStore.apply(this._db,arguments))},proxyProperties(UpgradeDB,'_db',['name','version','objectStoreNames']),proxyMethods(UpgradeDB,'_db',IDBDatabase,['deleteObjectStore','close']),DB.prototype.transaction=function(){return new Transaction(this._db.transaction.apply(this._db,arguments))},proxyProperties(DB,'_db',['name','version','objectStoreNames']),proxyMethods(DB,'_db',IDBDatabase,['close']),['openCursor','openKeyCursor'].forEach(function(ue){[ObjectStore,Index].forEach(function(le){le.prototype[ue.replace('open','iterate')]=function(){var he=toArray(arguments),pe=he[he.length-1],ge=this._store||this._index,me=ge[ue].apply(ge,he.slice(0,-1));me.onsuccess=function(){pe(me.result)}}})}),[Index,ObjectStore].forEach(function(ue){ue.prototype.getAll||(ue.prototype.getAll=function(le,he){var pe=this,ge=[];return new Promise(function(me){pe.iterateCursor(le,function(fe){return fe?(ge.push(fe.value),void 0!==he&&ge.length==he?void me(ge):void fe.continue()):void me(ge)})})})});ce.exports={open:function(ue,le,he){var pe=promisifyRequestCall(indexedDB,'open',[ue,le]),ge=pe.request;return ge.onupgradeneeded=function(me){he&&he(new UpgradeDB(ge.result,me.oldVersion,ge.transaction))},pe.then(function(me){return new DB(me)})},delete:function(ue){return promisifyRequestCall(indexedDB,'deleteDatabase',[ue])}}})()});const B={'max-entries-or-age-required':`Either the maxEntries or maxAgeSeconds
    parameters (or both) are required when constructing Plugin.`,'max-entries-must-be-number':`The maxEntries parameter to the Plugin
    constructor must either be a number or undefined.`,'max-age-seconds-must-be-number':`The maxAgeSeconds parameter to the Plugin
    constructor must either be a number or undefined.`};var H=new ErrorFactory$1(B);class CacheExpiration{constructor({maxEntries:ce,maxAgeSeconds:de}={}){if(!(ce||de))throw H.createError('max-entries-or-age-required');if(ce&&'number'!=typeof ce)throw H.createError('max-entries-must-be-number');if(de&&'number'!=typeof de)throw H.createError('max-age-seconds-must-be-number');this.maxEntries=ce,this.maxAgeSeconds=de,this._dbs=new Map,this._caches=new Map,this._expirationMutex=!1,this._timestampForNextRun=null}getDB({cacheName:ce}={}){var de=this;return W(function*(){l.isType({cacheName:ce},'string');const ue=`${M}-${ce}`;if(!de._dbs.has(ue)){const le=yield K.open(ue,1,function(he){const pe=he.createObjectStore(ce,{keyPath:G});pe.createIndex(V,V,{unique:!1})});de._dbs.set(ue,le)}return de._dbs.get(ue)})()}getCache({cacheName:ce}={}){var de=this;return W(function*(){if(l.isType({cacheName:ce},'string'),!de._caches.has(ce)){const ue=yield caches.open(ce);de._caches.set(ce,ue)}return de._caches.get(ce)})()}isResponseFresh({cachedResponse:ce,now:de}={}){if(ce&&this.maxAgeSeconds){l.isInstance({cachedResponse:ce},Response);const ue=ce.headers.get('date');if(ue){'undefined'==typeof de&&(de=Date.now());const le=new Date(ue);if(le.getTime()+1e3*this.maxAgeSeconds<de)return!1}}return!0}updateTimestamp({cacheName:ce,url:de,now:ue}={}){var le=this;return W(function*(){l.isType({url:de},'string'),l.isType({cacheName:ce},'string'),'undefined'==typeof ue&&(ue=Date.now());const he=yield le.getDB({cacheName:ce}),pe=he.transaction(ce,'readwrite');pe.objectStore(ce).put({[V]:ue,[G]:de}),yield pe.complete})()}expireEntries({cacheName:ce,now:de}={}){var ue=this;return W(function*(){if(ue._expirationMutex)return void(ue._timestampForNextRun=de);ue._expirationMutex=!0,l.isType({cacheName:ce},'string'),'undefined'==typeof de&&(de=Date.now());const le=ue.maxAgeSeconds?yield ue.findOldEntries({cacheName:ce,now:de}):[],he=ue.maxEntries?yield ue.findExtraEntries({cacheName:ce}):[],pe=[...new Set(le.concat(he))];if(yield ue.deleteFromCacheAndIDB({cacheName:ce,urls:pe}),0<pe.length&&I.debug({that:ue,message:'Expired entries have been removed from the cache.',data:{cacheName:ce,urls:pe}}),ue._expirationMutex=!1,ue._timestampForNextRun){const ge=ue._timestampForNextRun;return ue._timestampForNextRun=null,ue.expireEntries({cacheName:ce,now:ge})}})()}findOldEntries({cacheName:ce,now:de}={}){var ue=this;return W(function*(){l.isType({cacheName:ce},'string'),l.isType({now:de},'number');const le=de-1e3*ue.maxAgeSeconds,he=[],pe=yield ue.getDB({cacheName:ce}),ge=pe.transaction(ce,'readonly'),me=ge.objectStore(ce),fe=me.index(V);return fe.iterateCursor(function(_e){_e&&(_e.value[V]<le&&he.push(_e.value[G]),_e.continue())}),yield ge.complete,he})()}findExtraEntries({cacheName:ce}={}){var de=this;return W(function*(){l.isType({cacheName:ce},'string');const ue=[],le=yield de.getDB({cacheName:ce});let he=le.transaction(ce,'readonly'),pe=he.objectStore(ce),ge=pe.index(V);const me=yield ge.count();return me>de.maxEntries&&(he=le.transaction(ce,'readonly'),pe=he.objectStore(ce),ge=pe.index(V),ge.iterateCursor(function(fe){fe&&(ue.push(fe.value[G]),me-ue.length>de.maxEntries&&fe.continue())})),yield he.complete,ue})()}deleteFromCacheAndIDB({cacheName:ce,urls:de}={}){var ue=this;return W(function*(){if(l.isType({cacheName:ce},'string'),l.isArrayOfType({urls:de},'string'),0<de.length){const le=yield ue.getCache({cacheName:ce}),he=yield ue.getDB({cacheName:ce});for(let pe of de){yield le.delete(pe);const ge=he.transaction(ce,'readwrite'),me=ge.objectStore(ce);me.delete(pe),yield ge.complete}}})()}}class CacheExpirationPlugin extends CacheExpiration{cacheWillMatch({cachedResponse:ce,now:de}={}){return this.isResponseFresh({cachedResponse:ce,now:de})?ce:null}cacheDidUpdate({cacheName:ce,newResponse:de,url:ue,now:le}={}){var he=this;return W(function*(){l.isType({cacheName:ce},'string'),l.isInstance({newResponse:de},Response),'undefined'==typeof le&&(le=Date.now()),yield he.updateTimestamp({cacheName:ce,url:ue,now:le}),yield he.expireEntries({cacheName:ce,now:le})})()}}const $={'channel-name-required':`The channelName parameter is required when
    constructing a new BroadcastCacheUpdate instance.`,'responses-are-same-parameters-required':`The first, second, and
    headersToCheck parameters must be valid when calling responsesAreSame()`};var Y=new ErrorFactory$1($);const z='CACHE_UPDATED',Q=['content-length','etag','last-modified'];class BroadcastCacheUpdate{constructor({channelName:ce,headersToCheck:de,source:ue}={}){if('string'!=typeof ce||0===ce.length)throw Y.createError('channel-name-required');this.channelName=ce,this.headersToCheck=de||Q,this.source=ue||'sw-broadcast-cache-update'}get channel(){return this._channel||(this._channel=new BroadcastChannel(this.channelName)),this._channel}notifyIfUpdated({first:ce,second:de,cacheName:ue,url:le}){l.isType({cacheName:ue},'string'),responsesAreSame({first:ce,second:de,headersToCheck:this.headersToCheck})||broadcastUpdate({cacheName:ue,url:le,channel:this.channel,source:this.source})}}class BroadcastCacheUpdatePlugin extends BroadcastCacheUpdate{cacheDidUpdate({cacheName:ce,oldResponse:de,newResponse:ue,url:le}){l.isType({cacheName:ce},'string'),l.isInstance({newResponse:ue},Response),de&&this.notifyIfUpdated({cacheName:ce,first:de,second:ue,url:le})}}class Strategies{constructor({cacheId:ce}={}){this._cacheId=ce}cacheFirst(ce){return this._getCachingMechanism(CacheFirst,ce)}cacheOnly(ce){return this._getCachingMechanism(CacheOnly,ce)}networkFirst(ce){return this._getCachingMechanism(NetworkFirst,ce)}networkOnly(ce){return this._getCachingMechanism(NetworkOnly,ce)}staleWhileRevalidate(ce){return this._getCachingMechanism(StaleWhileRevalidate,ce)}_getCachingMechanism(ce,de={}){const ue={cacheExpiration:CacheExpirationPlugin,broadcastCacheUpdate:BroadcastCacheUpdatePlugin,cacheableResponse:CacheableResponsePlugin},le={plugins:[],cacheId:this._cacheId};de.cacheName&&(le.cacheName=de.cacheName);const he=Object.keys(ue);return he.forEach((pe)=>{if(de[pe]){const ge=ue[pe],me=de[pe];le.plugins.push(new ge(me))}}),de.plugins&&de.plugins.forEach((pe)=>{le.plugins.push(pe)}),new ce({requestWrapper:new RequestWrapper(le)})}}const X={'not-in-sw':'sw-precaching must be loaded in your service worker file.','invalid-revisioned-entry':`File manifest entries must be either a `+`string with revision info in the url or an object with a 'url' and `+`'revision' parameters.`,'invalid-unrevisioned-entry':``,'bad-cache-bust':`The cache bust parameter must be a boolean.`,'duplicate-entry-diff-revisions':`An attempt was made to cache the same `+`url twice with each having different revisions. This is not supported.`,'request-not-cached':`A request failed the criteria to be cached. By `+`default, only responses with 'response.ok = true' are cached.`,'should-override':'Method should be overridden by the extending class.','bad-cache-id':`The 'cacheId' parameter must be a string with at least `+`one character.`};var Z=new ErrorFactory$1(X);class BaseCacheManager{constructor({cacheName:ce,cacheId:de,plugins:ue}={}){if(de&&('string'!=typeof de||0===de.length))throw Z.createError('bad-cache-id');this._entriesToCache=new Map,this._requestWrapper=new RequestWrapper({cacheName:ce,cacheId:de,plugins:ue,fetchOptions:{credentials:'same-origin'}})}_addEntries(ce){this._parsedCacheUrls=null,ce.forEach((de)=>{this._addEntryToInstallList(this._parseEntry(de))})}getCacheName(){return this._requestWrapper.cacheName}getCachedUrls(){return this._parsedCacheUrls||(this._parsedCacheUrls=Array.from(this._entriesToCache.keys()).map((ce)=>new URL(ce,location).href)),this._parsedCacheUrls}_addEntryToInstallList(ce){const de=ce.entryID,ue=this._entriesToCache.get(ce.entryID);return ue?void this._onDuplicateInstallEntryFound(ce,ue):void this._entriesToCache.set(de,ce)}install(){var ce=this;return W(function*(){if(0===ce._entriesToCache.size)return;const de=[];return ce._entriesToCache.forEach(function(ue){de.push(ce._cacheEntry(ue))}),Promise.all(de)})()}_cacheEntry(ce){var de=this;return W(function*(){const ue=yield de._isAlreadyCached(ce);if(!ue)try{return yield de._requestWrapper.fetchAndCache({request:ce.getNetworkRequest(),waitOnCache:!0,cacheKey:ce.request,cleanRedirects:!0}),de._onEntryCached(ce)}catch(le){throw Z.createError('request-not-cached',{message:`Failed to get a cacheable response for `+`'${ce.request.url}': ${le.message}`})}})()}cleanup(){var ce=this;return W(function*(){if(!(yield caches.has(ce.getCacheName())))return;const de=[];ce._entriesToCache.forEach(function(pe){de.push(pe.request.url)});const ue=yield ce._getCache(),le=yield ue.keys(),he=le.filter(function(pe){return!de.includes(pe.url)});return Promise.all(he.map(function(pe){return ue.delete(pe)}))})()}_getCache(){var ce=this;return W(function*(){return ce._cache||(ce._cache=yield caches.open(ce.getCacheName())),ce._cache})()}_parseEntry(){throw Z.createError('should-override')}_onDuplicateEntryFound(){throw Z.createError('should-override')}_isAlreadyCached(){throw Z.createError('should-override')}_onEntryCached(){throw Z.createError('should-override')}}class IDBHelper{constructor(ce,de,ue){if(ce==void 0||de==void 0||ue==void 0)throw Error('name, version, storeName must be passed to the constructor.');this._name=ce,this._version=de,this._storeName=ue}_getDb(){return this._dbPromise?this._dbPromise:(this._dbPromise=K.open(this._name,this._version,(ce)=>{ce.createObjectStore(this._storeName)}).then((ce)=>{return ce}),this._dbPromise)}close(){return this._dbPromise?this._dbPromise.then((ce)=>{ce.close(),this._dbPromise=null}):void 0}put(ce,de){return this._getDb().then((ue)=>{const le=ue.transaction(this._storeName,'readwrite'),he=le.objectStore(this._storeName);return he.put(de,ce),le.complete})}delete(ce){return this._getDb().then((de)=>{const ue=de.transaction(this._storeName,'readwrite'),le=ue.objectStore(this._storeName);return le.delete(ce),ue.complete})}get(ce){return this._getDb().then((de)=>{return de.transaction(this._storeName).objectStore(this._storeName).get(ce)})}getAllValues(){return this._getDb().then((ce)=>{return ce.transaction(this._storeName).objectStore(this._storeName).getAll()})}getAllKeys(){return this._getDb().then((ce)=>{return ce.transaction(this._storeName).objectStore(this._storeName).getAllKeys()})}}let ie=`sw-precaching-revisioned-${'v1'}`;self&&self.registration&&(ie+=`-${self.registration.scope}`);const oe=ie;class RevisionDetailsModel{constructor(){this._idbHelper=new IDBHelper('sw-precaching','1','asset-revisions')}get(ce){return this._idbHelper.get(ce)}put(ce,de){return this._idbHelper.put(ce,de)}_close(){this._idbHelper.close()}}class BaseCacheEntry{constructor({entryID:ce,revision:de,request:ue,cacheBust:le}){this.entryID=ce,this.revision=de,this.request=ue,this.cacheBust=le}getNetworkRequest(){if(!0!==this.cacheBust)return this.request;let ce=this.request.url;const de={};if(!0===this.cacheBust)if('cache'in Request.prototype)de.cache='reload';else{const ue=new URL(ce,location);ue.search+=(ue.search?'&':'')+encodeURIComponent('_sw-precaching')+'='+encodeURIComponent(this.revision),ce=ue.toString()}return new Request(ce,de)}}class StringCacheEntry extends BaseCacheEntry{constructor(ce){if(l.isType({url:ce},'string'),0===ce.length)throw Z.createError('invalid-revisioned-entry',new Error('Bad url Parameter. It should be a string:'+JSON.stringify(ce)));super({entryID:ce,revision:ce,request:new Request(ce),cacheBust:!1})}}class DefaultsCacheEntry extends BaseCacheEntry{constructor({entryID:ce,revision:de,url:ue,cacheBust:le}){if('undefined'==typeof le&&(le=!0),'undefined'==typeof ce&&(ce=new URL(ue,location).toString()),l.isType({revision:de},'string'),0===de.length)throw Z.createError('invalid-revisioned-entry',new Error('Bad revision Parameter. It should be a string with at least one character: '+JSON.stringify(de)));if(l.isType({url:ue},'string'),0===ue.length)throw Z.createError('invalid-revisioned-entry',new Error('Bad url Parameter. It should be a string:'+JSON.stringify(ue)));if(l.isType({entryID:ce},'string'),0===ce.length)throw Z.createError('invalid-revisioned-entry',new Error('Bad entryID Parameter. It should be a string with at least one character: '+JSON.stringify(ce)));l.isType({cacheBust:le},'boolean'),super({entryID:ce,revision:de,request:new Request(ue),cacheBust:le})}}class RevisionedCacheManager extends BaseCacheManager{constructor(ce={}){ce.cacheName=ce.cacheName||oe,super(ce),this._revisionDetailsModel=new RevisionDetailsModel}addToCacheList({revisionedFiles:ce}={}){l.isInstance({revisionedFiles:ce},Array),super._addEntries(ce);const de=ce.filter((ue)=>'string'==typeof ue);0<de.length&&I.debug({that:this,message:`Some precache entries are URLs without separate revision
          fields. If the URLs themselves do not contain revisioning info,
          like a hash or a version number, your users won't receive updates.`,data:{'URLs without revision fields':JSON.stringify(de),'Examples of safe, versioned URLs':`'/path/file.abcd1234.css' or '/v1.0.0/file.js'`,'Examples of dangerous, unversioned URLs':`'index.html' or '/path/file.css' or '/latest/file.js'`}})}_parseEntry(ce){if('undefined'==typeof ce||null===ce)throw Z.createError('invalid-revisioned-entry',new Error('Invalid file entry: '+JSON.stringify(ce)));let de;switch(typeof ce){case'string':de=new StringCacheEntry(ce);break;case'object':de=new DefaultsCacheEntry(ce);break;default:throw Z.createError('invalid-revisioned-entry',new Error('Invalid file entry: '+JSON.stringify(de)));}return de}_onDuplicateInstallEntryFound(ce,de){if(de.revision!==ce.revision)throw Z.createError('duplicate-entry-diff-revisions',new Error(`${JSON.stringify(de)} <=> `+`${JSON.stringify(ce)}`))}_isAlreadyCached(ce){var de=this;return W(function*(){const ue=yield de._revisionDetailsModel.get(ce.entryID);if(ue!==ce.revision)return!1;const le=yield de._getCache(),he=yield le.match(ce.request);return!!he})()}_onEntryCached(ce){var de=this;return W(function*(){yield de._revisionDetailsModel.put(ce.entryID,ce.revision)})()}_close(){this._revisionDetailsModel._close()}cleanup(){return super.cleanup().then(()=>{return this._close()})}}if(!l.isSWEnv())throw Z.createError('not-in-sw');class SWLib$1{constructor({cacheId:ce,clientsClaim:de,handleFetch:ue,directoryIndex:le='index.html',precacheChannelName:he='precache-updates'}={}){if(ce&&('string'!=typeof ce||0===ce.length))throw r.createError('bad-cache-id');if(de&&'boolean'!=typeof de)throw r.createError('bad-clients-claim');if('undefined'!=typeof le)if(!1===le||null===le)le=!1;else if('string'!=typeof le||0===le.length)throw r.createError('bad-directory-index');const pe=[];he&&pe.push(new BroadcastCacheUpdatePlugin({channelName:he,source:registration&&registration.scope?registration.scope:location})),this._runtimeCacheName=R({cacheId:ce}),this._revisionedCacheManager=new RevisionedCacheManager({cacheId:ce,plugins:pe}),this._strategies=new Strategies({cacheId:ce}),this._router=new Router$$1(this._revisionedCacheManager.getCacheName(),ue),this._registerInstallActivateEvents(de),this._registerDefaultRoutes(le)}precache(ce){if(!Array.isArray(ce))throw r.createError('bad-revisioned-cache-list');this._revisionedCacheManager.addToCacheList({revisionedFiles:ce})}get router(){return this._router}get strategies(){return this._strategies}get runtimeCacheName(){return this._runtimeCacheName}_registerInstallActivateEvents(ce){self.addEventListener('install',(de)=>{const ue=this._revisionedCacheManager.getCachedUrls();0<ue.length&&I.debug({that:this,message:`The precached URLs will automatically be served using a
            cache-first strategy.`,data:{'Precached URLs':JSON.stringify(ue)}}),de.waitUntil(this._revisionedCacheManager.install())}),self.addEventListener('activate',(de)=>{de.waitUntil(this._revisionedCacheManager.cleanup().then(()=>{if(ce)return self.clients.claim()}))})}_registerDefaultRoutes(ce){const de=[];ce&&de.push(this._getDirectoryIndexPlugin(ce));const ue=this.strategies.cacheFirst({cacheName:this._revisionedCacheManager.getCacheName(),plugins:de}),le=new Route({match:({url:he})=>{const pe=this._revisionedCacheManager.getCachedUrls();return-1!==pe.indexOf(he.href)||ce&&he.pathname.endsWith('/')&&(he.pathname+=ce,-1!==pe.indexOf(he.href))},handler:ue});this.router.registerRoute(le)}_getDirectoryIndexPlugin(ce){const de=(()=>{var ue=W(function*({request:le,cache:he,cachedResponse:pe,matchOptions:ge}){if(pe)return pe;if(le.url.endsWith('/')){let me=new URL(le.url);return me.pathname+=ce,he.match(me.toString(),ge)}});return function directoryIndexFunc(){return ue.apply(this,arguments)}})();return{cacheWillMatch:de}}}if(!l.isSWEnv())throw r.createError('not-in-sw');return SWLib$1});
//# sourceMappingURL=sw-lib.min.js.map
